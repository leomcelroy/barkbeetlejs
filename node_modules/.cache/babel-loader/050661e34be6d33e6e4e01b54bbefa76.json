{"ast":null,"code":"import _toConsumableArray from \"/Users/leomcelroy/Desktop/barkBeetleEverything/barkbeetle_js_real/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\n// makerjs model, depth, params -> pocket toolpath\nimport * as mjs from 'makerjs';\nvar STRANGE_CORRECTION = 0.0000001; //TODO: why is this neccessary otherwise outline shits the bed\n\nvar len = function len(toolpath) {\n  return Object.keys(toolpath.models).length;\n};\n\nvar isToolpath = function isToolpath(toolpath) {\n  console.log(\"toolpath\", toolpath);\n\n  if (len(toolpath) === 1) {\n    return true;\n  } else if (len(toolpath) > 1) {\n    return false;\n  } else {\n    return false;\n  }\n};\n\nvar intToolpath = function intToolpath(geo, radius) {\n  var corners = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 1;\n  // console.log(\"geo\", geo);\n  // console.log(len(geo));\n  // let corners = (len(geo) === 1) ? 1 : 0;\n  return mjs.model.outline(geo, radius + STRANGE_CORRECTION, corners, true);\n};\n\nvar temp = {\n  \"models\": {\n    \"0\": {\n      \"paths\": {\n        \"BottomRight_EndCap_ShapeLine2_StartCap_ShapeLine2_StartCap_ShapeLine2_StartCap_ShapeLine1_Bottom\": {\n          \"type\": \"line\",\n          \"origin\": [18.850000199999997, 9.5653415],\n          \"end\": [18.466667437119213, 9.999999986534995]\n        },\n        \"TopRight_StartCap_ShapeLine2_StartCap_ShapeLine2_StartCap_ShapeLine2_StartCap_ShapeLine2_Bottom\": {\n          \"type\": \"line\",\n          \"origin\": [18.466667437119213, 9.999999986535002],\n          \"end\": [18.8500002, 10.434658499999998]\n        },\n        \"TopRight_StartCap_ShapeLine2_StartCap_ShapeLine2_StartCap_ShapeLine2_Bottom_Bottom\": {\n          \"type\": \"line\",\n          \"origin\": [18.850000199999997, 10.434658499999998],\n          \"end\": [19.5250003, 11.200036699999998]\n        },\n        \"TopRight_StartCap_ShapeLine2_StartCap_ShapeLine2_Bottom_Bottom_Bottom\": {\n          \"type\": \"line\",\n          \"origin\": [19.525000299999995, 11.200036699999998],\n          \"end\": [20.200000399999997, 11.965414899999999]\n        },\n        \"TopRight_StartCap_ShapeLine2_Bottom_Bottom_Bottom_Bottom\": {\n          \"type\": \"line\",\n          \"origin\": [20.200000399999993, 11.965414899999997],\n          \"end\": [21.325000499999994, 13.241045099999997]\n        },\n        \"TopLeft_Inner_Inner_Inner_Inner_Inner\": {\n          \"type\": \"arc\",\n          \"origin\": [25, 10],\n          \"radius\": 4.899999500000002,\n          \"startAngle\": 90,\n          \"endAngle\": 138.5903777947364\n        },\n        \"TopRight_Inner_Inner_Inner_Inner_Inner\": {\n          \"type\": \"arc\",\n          \"origin\": [25, 10],\n          \"radius\": 4.899999500000002,\n          \"startAngle\": 0,\n          \"endAngle\": 90\n        },\n        \"BottomRight_Inner_1_Inner_Inner_Inner_Inner\": {\n          \"type\": \"arc\",\n          \"origin\": [25, 10],\n          \"radius\": 4.899999500000002,\n          \"startAngle\": 270,\n          \"endAngle\": 360\n        },\n        \"BottomLeft_Inner_1_Inner_Inner_Inner_Inner\": {\n          \"type\": \"arc\",\n          \"origin\": [25, 10],\n          \"radius\": 4.899999500000002,\n          \"startAngle\": 221.4096222052636,\n          \"endAngle\": 270\n        },\n        \"BottomRight_EndCap_ShapeLine1_Bottom_Bottom_Bottom_Bottom\": {\n          \"type\": \"line\",\n          \"origin\": [21.325000499999994, 6.758954900000001],\n          \"end\": [20.200000399999997, 8.034585100000001]\n        },\n        \"BottomRight_EndCap_ShapeLine2_StartCap_ShapeLine1_Bottom_Bottom_Bottom\": {\n          \"type\": \"line\",\n          \"origin\": [20.200000399999993, 8.034585100000001],\n          \"end\": [19.525000299999995, 8.799963300000002]\n        },\n        \"BottomRight_EndCap_ShapeLine2_StartCap_ShapeLine2_StartCap_ShapeLine1_Bottom_Bottom\": {\n          \"type\": \"line\",\n          \"origin\": [19.525000299999995, 8.7999633],\n          \"end\": [18.850000199999997, 9.565341499999999]\n        }\n      }\n    },\n    \"1\": {\n      \"paths\": {\n        \"BottomLeft_Inner_Inner_Inner_Inner_Inner\": {\n          \"type\": \"arc\",\n          \"origin\": [10, 10],\n          \"radius\": 4.899999500000002,\n          \"startAngle\": 180,\n          \"endAngle\": 270\n        },\n        \"BottomRight_Inner_Inner_Inner_Inner_Inner\": {\n          \"type\": \"arc\",\n          \"origin\": [10, 10],\n          \"radius\": 4.899999500000002,\n          \"startAngle\": 270,\n          \"endAngle\": 318.59037779473647\n        },\n        \"BottomRight_EndCap_ShapeLine2_Bottom_Bottom_Bottom_Bottom\": {\n          \"type\": \"line\",\n          \"origin\": [14.799999600000003, 8.034585100000001],\n          \"end\": [13.674999500000004, 6.758954900000001]\n        },\n        \"BottomRight_EndCap_ShapeLine2_StartCap_ShapeLine2_Bottom_Bottom_Bottom\": {\n          \"type\": \"line\",\n          \"origin\": [15.474999700000003, 8.7999633],\n          \"end\": [14.799999600000003, 8.0345851]\n        },\n        \"BottomRight_EndCap_ShapeLine2_StartCap_ShapeLine2_StartCap_ShapeLine2_Bottom_Bottom\": {\n          \"type\": \"line\",\n          \"origin\": [16.149999800000003, 9.5653415],\n          \"end\": [15.474999700000001, 8.7999633]\n        },\n        \"BottomRight_EndCap_ShapeLine2_StartCap_ShapeLine2_StartCap_ShapeLine2_StartCap_ShapeLine2_Bottom\": {\n          \"type\": \"line\",\n          \"origin\": [16.533332529251677, 10.000000024666834],\n          \"end\": [16.1499998, 9.565341499999999]\n        },\n        \"TopRight_StartCap_ShapeLine2_StartCap_ShapeLine2_StartCap_ShapeLine2_StartCap_ShapeLine1_Bottom\": {\n          \"type\": \"line\",\n          \"origin\": [16.149999800000003, 10.434658499999998],\n          \"end\": [16.533332529251677, 10.000000024666832]\n        },\n        \"TopRight_StartCap_ShapeLine2_StartCap_ShapeLine2_StartCap_ShapeLine1_Bottom_Bottom\": {\n          \"type\": \"line\",\n          \"origin\": [15.474999700000003, 11.200036699999998],\n          \"end\": [16.149999800000003, 10.434658499999998]\n        },\n        \"TopRight_StartCap_ShapeLine2_StartCap_ShapeLine1_Bottom_Bottom_Bottom\": {\n          \"type\": \"line\",\n          \"origin\": [14.799999600000003, 11.965414899999997],\n          \"end\": [15.474999700000003, 11.200036699999998]\n        },\n        \"TopRight_StartCap_ShapeLine1_Bottom_Bottom_Bottom_Bottom\": {\n          \"type\": \"line\",\n          \"origin\": [13.674999499999998, 13.241045099999997],\n          \"end\": [14.799999599999998, 11.965414899999997]\n        },\n        \"TopRight_Inner_1_Inner_Inner_Inner_Inner\": {\n          \"type\": \"arc\",\n          \"origin\": [10, 10],\n          \"radius\": 4.899999500000002,\n          \"startAngle\": 41.40962220526359,\n          \"endAngle\": 90\n        },\n        \"TopLeft_Inner_1_Inner_Inner_Inner_Inner\": {\n          \"type\": \"arc\",\n          \"origin\": [10, 10],\n          \"radius\": 4.899999500000002,\n          \"startAngle\": 90,\n          \"endAngle\": 180\n        }\n      }\n    }\n  }\n};\n\nvar intToolpaths = function intToolpaths(geo, params) {\n  var pass = intToolpath(geo, params.compensatedRadius);\n\n  if (isToolpath(pass) !== true) {\n    return {\n      models: {}\n    };\n  }\n\n  var models = {};\n  var count = 0;\n  var corners = 1;\n\n  while (isToolpath(pass) && count < 5) {\n    models[count] = pass;\n    count++;\n    pass = intToolpath(models[count - 1], params.compensatedRadius * params.stepoverPercentage, corners);\n\n    if (len(pass) > 1) {\n      corners = 0;\n    }\n\n    console.log(\"pass\", pass, \"count\", count, \"ispath\", isToolpath(pass));\n  }\n\n  var model = {\n    models: models\n  };\n  console.log(\"model\", model);\n  return model;\n};\n\nvar pocket = function pocket(model, params) {\n  //let p = model.models.profile;\n  var p = model; // let outline = mjs.model.outline(p, params.compensatedRadius, 1, true); //third parameter is what type of corners, 0 (rounded) by default\n\n  var outline = intToolpath(p, params.compensatedRadius);\n  var outlines = intToolpaths(p, params);\n  var iterOut = Object.values(outlines.models);\n  var chains = mjs.model.findChains(outline);\n  var chain = mjs.model.findSingleChain(outline);\n  var chain2 = iterOut.map(function (x) {\n    return mjs.model.findSingleChain(x);\n  }); //TODO: need to change this to find chains\n\n  var divisions = Math.floor(chain.pathLength / params.minimumSpacing);\n  var spacing = chain.pathLength / divisions;\n  var keyPoints = mjs.chain.toKeyPoints(chain, spacing);\n  var keyPoints2 = chain2.map(function (x) {\n    return mjs.chain.toKeyPoints(x, spacing);\n  }); // console.log(keyPoints2);\n  // let scaleFactor = 10;\n  // let scaleXY = keyPoints.map(p => [p[0] * scaleFactor, p[1] * scaleFactor]);\n\n  var gcodePoints = keyPoints.map(function (p) {\n    return \"G1 X\".concat(p[0], \" Y\").concat(p[1], \" F\").concat(params.feedRate);\n  });\n  var gcodePoints2 = keyPoints2.map(function (x) {\n    return x.map(function (p) {\n      return \"G1 X\".concat(p[0], \" Y\").concat(p[1], \" F\").concat(params.feedRate);\n    });\n  }); // console.log(gcodePoints2)\n  // gcodePoints2 = gcodePoints2.flat(1);\n  // let gcode = JSON.parse(JSON.stringify(gcodePoints));\n  // let gcode2 = JSON.parse(JSON.stringify(gcodePoints2));\n  //console.log(gcode2);\n\n  var firstPoint = keyPoints[0];\n  var firstPoints2 = keyPoints2.map(function (x) {\n    return x[0];\n  }); // console.log(firstPoints2)\n\n  var paths = params.depthOfPasses.map(function (p, i) {\n    return [\"G1 Z\".concat(params.depthOfPasses[i], \" F12.0\")].concat(_toConsumableArray(gcodePoints), [\"G1 X\".concat(firstPoint[0], \" Y\").concat(firstPoint[1], \" F\").concat(params.feedRate)]);\n  });\n  paths = paths.flat(1);\n  var paths2 = gcodePoints2.map(function (p, i) {\n    return _toConsumableArray(p).concat([\"G1 X\".concat(firstPoints2[i][0], \" Y\").concat(firstPoints2[i][1], \" F\").concat(params.feedRate)]);\n  });\n  paths2 = paths2.flat(1); //console.log(paths2)\n\n  var paths3 = params.depthOfPasses.map(function (p, i) {\n    return [\"G1 Z\".concat(params.depthOfPasses[i], \" F12.0\")].concat(_toConsumableArray(paths2));\n  });\n  paths3 = paths3.flat(1); // console.log(paths3)\n\n  var gcode = [params.units, \"G90\", \"G1 Z\".concat(params.jogHeight, \" F9.0\"), \"G0 X\".concat(firstPoint[0], \" Y\").concat(firstPoint[1])].concat(_toConsumableArray(paths));\n  var gcode2 = [params.units, \"G90\", \"G1 Z\".concat(params.jogHeight, \" F9.0\"), \"G0 X\".concat(firstPoints2[0][0], \" Y\").concat(firstPoints2[0][1])].concat(_toConsumableArray(paths3), [\"G1 Z\".concat(params.jogHeight, \" F9.0\")]); // write to a new file named\n\n  var filename = 'testGcodePocket.nc';\n  var text = gcode2.join('\\n');\n  return {\n    drawing: outlines,\n    gcode: text,\n    filename: filename\n  };\n};\n\nexport { pocket };","map":{"version":3,"sources":["/Users/leomcelroy/Desktop/barkBeetleEverything/barkbeetle_js_real/src/toolpaths/pocket.js"],"names":["mjs","STRANGE_CORRECTION","len","toolpath","Object","keys","models","length","isToolpath","console","log","intToolpath","geo","radius","corners","model","outline","temp","intToolpaths","params","pass","compensatedRadius","count","stepoverPercentage","pocket","p","outlines","iterOut","values","chains","findChains","chain","findSingleChain","chain2","map","x","divisions","Math","floor","pathLength","minimumSpacing","spacing","keyPoints","toKeyPoints","keyPoints2","gcodePoints","feedRate","gcodePoints2","firstPoint","firstPoints2","paths","depthOfPasses","i","flat","paths2","paths3","gcode","units","jogHeight","gcode2","filename","text","join","drawing"],"mappings":"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","sourcesContent":["// makerjs model, depth, params -> pocket toolpath\nimport * as mjs from 'makerjs';\n\nconst STRANGE_CORRECTION = 0.0000001; //TODO: why is this neccessary otherwise outline shits the bed\n\nconst len = (toolpath) => Object.keys(toolpath.models).length;\n\nconst isToolpath = (toolpath) => {\n  console.log(\"toolpath\", toolpath);\n\n\n  if (len(toolpath) === 1) {\n    return true;\n  } else if (len(toolpath) > 1) {\n    return false;\n  } else {\n    return false;\n  }\n}\n\nconst intToolpath = (geo, radius, corners = 1) => {\n  // console.log(\"geo\", geo);\n  // console.log(len(geo));\n  // let corners = (len(geo) === 1) ? 1 : 0;\n\n  return mjs.model.outline(geo, radius + STRANGE_CORRECTION, corners, true);\n}\n\nlet temp = {\n  \"models\": {\n    \"0\": {\n      \"paths\": {\n        \"BottomRight_EndCap_ShapeLine2_StartCap_ShapeLine2_StartCap_ShapeLine2_StartCap_ShapeLine1_Bottom\": {\n          \"type\": \"line\",\n          \"origin\": [\n            18.850000199999997,\n            9.5653415\n          ],\n          \"end\": [\n            18.466667437119213,\n            9.999999986534995\n          ]\n        },\n        \"TopRight_StartCap_ShapeLine2_StartCap_ShapeLine2_StartCap_ShapeLine2_StartCap_ShapeLine2_Bottom\": {\n          \"type\": \"line\",\n          \"origin\": [\n            18.466667437119213,\n            9.999999986535002\n          ],\n          \"end\": [\n            18.8500002,\n            10.434658499999998\n          ]\n        },\n        \"TopRight_StartCap_ShapeLine2_StartCap_ShapeLine2_StartCap_ShapeLine2_Bottom_Bottom\": {\n          \"type\": \"line\",\n          \"origin\": [\n            18.850000199999997,\n            10.434658499999998\n          ],\n          \"end\": [\n            19.5250003,\n            11.200036699999998\n          ]\n        },\n        \"TopRight_StartCap_ShapeLine2_StartCap_ShapeLine2_Bottom_Bottom_Bottom\": {\n          \"type\": \"line\",\n          \"origin\": [\n            19.525000299999995,\n            11.200036699999998\n          ],\n          \"end\": [\n            20.200000399999997,\n            11.965414899999999\n          ]\n        },\n        \"TopRight_StartCap_ShapeLine2_Bottom_Bottom_Bottom_Bottom\": {\n          \"type\": \"line\",\n          \"origin\": [\n            20.200000399999993,\n            11.965414899999997\n          ],\n          \"end\": [\n            21.325000499999994,\n            13.241045099999997\n          ]\n        },\n        \"TopLeft_Inner_Inner_Inner_Inner_Inner\": {\n          \"type\": \"arc\",\n          \"origin\": [\n            25,\n            10\n          ],\n          \"radius\": 4.899999500000002,\n          \"startAngle\": 90,\n          \"endAngle\": 138.5903777947364\n        },\n        \"TopRight_Inner_Inner_Inner_Inner_Inner\": {\n          \"type\": \"arc\",\n          \"origin\": [\n            25,\n            10\n          ],\n          \"radius\": 4.899999500000002,\n          \"startAngle\": 0,\n          \"endAngle\": 90\n        },\n        \"BottomRight_Inner_1_Inner_Inner_Inner_Inner\": {\n          \"type\": \"arc\",\n          \"origin\": [\n            25,\n            10\n          ],\n          \"radius\": 4.899999500000002,\n          \"startAngle\": 270,\n          \"endAngle\": 360\n        },\n        \"BottomLeft_Inner_1_Inner_Inner_Inner_Inner\": {\n          \"type\": \"arc\",\n          \"origin\": [\n            25,\n            10\n          ],\n          \"radius\": 4.899999500000002,\n          \"startAngle\": 221.4096222052636,\n          \"endAngle\": 270\n        },\n        \"BottomRight_EndCap_ShapeLine1_Bottom_Bottom_Bottom_Bottom\": {\n          \"type\": \"line\",\n          \"origin\": [\n            21.325000499999994,\n            6.758954900000001\n          ],\n          \"end\": [\n            20.200000399999997,\n            8.034585100000001\n          ]\n        },\n        \"BottomRight_EndCap_ShapeLine2_StartCap_ShapeLine1_Bottom_Bottom_Bottom\": {\n          \"type\": \"line\",\n          \"origin\": [\n            20.200000399999993,\n            8.034585100000001\n          ],\n          \"end\": [\n            19.525000299999995,\n            8.799963300000002\n          ]\n        },\n        \"BottomRight_EndCap_ShapeLine2_StartCap_ShapeLine2_StartCap_ShapeLine1_Bottom_Bottom\": {\n          \"type\": \"line\",\n          \"origin\": [\n            19.525000299999995,\n            8.7999633\n          ],\n          \"end\": [\n            18.850000199999997,\n            9.565341499999999\n          ]\n        }\n      }\n    },\n    \"1\": {\n      \"paths\": {\n        \"BottomLeft_Inner_Inner_Inner_Inner_Inner\": {\n          \"type\": \"arc\",\n          \"origin\": [\n            10,\n            10\n          ],\n          \"radius\": 4.899999500000002,\n          \"startAngle\": 180,\n          \"endAngle\": 270\n        },\n        \"BottomRight_Inner_Inner_Inner_Inner_Inner\": {\n          \"type\": \"arc\",\n          \"origin\": [\n            10,\n            10\n          ],\n          \"radius\": 4.899999500000002,\n          \"startAngle\": 270,\n          \"endAngle\": 318.59037779473647\n        },\n        \"BottomRight_EndCap_ShapeLine2_Bottom_Bottom_Bottom_Bottom\": {\n          \"type\": \"line\",\n          \"origin\": [\n            14.799999600000003,\n            8.034585100000001\n          ],\n          \"end\": [\n            13.674999500000004,\n            6.758954900000001\n          ]\n        },\n        \"BottomRight_EndCap_ShapeLine2_StartCap_ShapeLine2_Bottom_Bottom_Bottom\": {\n          \"type\": \"line\",\n          \"origin\": [\n            15.474999700000003,\n            8.7999633\n          ],\n          \"end\": [\n            14.799999600000003,\n            8.0345851\n          ]\n        },\n        \"BottomRight_EndCap_ShapeLine2_StartCap_ShapeLine2_StartCap_ShapeLine2_Bottom_Bottom\": {\n          \"type\": \"line\",\n          \"origin\": [\n            16.149999800000003,\n            9.5653415\n          ],\n          \"end\": [\n            15.474999700000001,\n            8.7999633\n          ]\n        },\n        \"BottomRight_EndCap_ShapeLine2_StartCap_ShapeLine2_StartCap_ShapeLine2_StartCap_ShapeLine2_Bottom\": {\n          \"type\": \"line\",\n          \"origin\": [\n            16.533332529251677,\n            10.000000024666834\n          ],\n          \"end\": [\n            16.1499998,\n            9.565341499999999\n          ]\n        },\n        \"TopRight_StartCap_ShapeLine2_StartCap_ShapeLine2_StartCap_ShapeLine2_StartCap_ShapeLine1_Bottom\": {\n          \"type\": \"line\",\n          \"origin\": [\n            16.149999800000003,\n            10.434658499999998\n          ],\n          \"end\": [\n            16.533332529251677,\n            10.000000024666832\n          ]\n        },\n        \"TopRight_StartCap_ShapeLine2_StartCap_ShapeLine2_StartCap_ShapeLine1_Bottom_Bottom\": {\n          \"type\": \"line\",\n          \"origin\": [\n            15.474999700000003,\n            11.200036699999998\n          ],\n          \"end\": [\n            16.149999800000003,\n            10.434658499999998\n          ]\n        },\n        \"TopRight_StartCap_ShapeLine2_StartCap_ShapeLine1_Bottom_Bottom_Bottom\": {\n          \"type\": \"line\",\n          \"origin\": [\n            14.799999600000003,\n            11.965414899999997\n          ],\n          \"end\": [\n            15.474999700000003,\n            11.200036699999998\n          ]\n        },\n        \"TopRight_StartCap_ShapeLine1_Bottom_Bottom_Bottom_Bottom\": {\n          \"type\": \"line\",\n          \"origin\": [\n            13.674999499999998,\n            13.241045099999997\n          ],\n          \"end\": [\n            14.799999599999998,\n            11.965414899999997\n          ]\n        },\n        \"TopRight_Inner_1_Inner_Inner_Inner_Inner\": {\n          \"type\": \"arc\",\n          \"origin\": [\n            10,\n            10\n          ],\n          \"radius\": 4.899999500000002,\n          \"startAngle\": 41.40962220526359,\n          \"endAngle\": 90\n        },\n        \"TopLeft_Inner_1_Inner_Inner_Inner_Inner\": {\n          \"type\": \"arc\",\n          \"origin\": [\n            10,\n            10\n          ],\n          \"radius\": 4.899999500000002,\n          \"startAngle\": 90,\n          \"endAngle\": 180\n        }\n      }\n    }\n  }\n};\n\nconst intToolpaths = (geo, params) => {\n  let pass = intToolpath(geo, params.compensatedRadius);\n\n  if (isToolpath(pass) !== true) {\n    return {models:{}};\n  }\n\n  let models = {}\n  let count = 0;\n  let corners = 1;\n\n  while ( isToolpath(pass) && count < 5) {\n    models[count] = pass;\n    count++;\n    pass = intToolpath(models[count - 1], params.compensatedRadius * params.stepoverPercentage, corners);\n    if (len(pass) > 1) {\n      corners = 0;\n    }\n\n    console.log(\"pass\", pass, \"count\", count, \"ispath\", isToolpath(pass));\n  }\n\n  let model = {models}\n\n  console.log(\"model\", model)\n\n  return model;\n}\n\nconst pocket = (model, params) => {\n  //let p = model.models.profile;\n  let p = model;\n\n  // let outline = mjs.model.outline(p, params.compensatedRadius, 1, true); //third parameter is what type of corners, 0 (rounded) by default\n  let outline = intToolpath(p, params.compensatedRadius);\n  let outlines = intToolpaths(p, params);\n  let iterOut = Object.values(outlines.models);\n\n  let chains = mjs.model.findChains(outline);\n  let chain = mjs.model.findSingleChain(outline);\n  let chain2 = iterOut.map(x => mjs.model.findSingleChain(x)); //TODO: need to change this to find chains\n\n  var divisions = Math.floor(chain.pathLength / params.minimumSpacing);\n  var spacing = chain.pathLength / divisions;\n\n  let keyPoints = mjs.chain.toKeyPoints(chain, spacing);\n  let keyPoints2 = chain2.map(x => mjs.chain.toKeyPoints(x, spacing));\n  // console.log(keyPoints2);\n\n  // let scaleFactor = 10;\n  // let scaleXY = keyPoints.map(p => [p[0] * scaleFactor, p[1] * scaleFactor]);\n\n  let gcodePoints = keyPoints.map(p => `G1 X${p[0]} Y${p[1]} F${params.feedRate}`)\n  let gcodePoints2 = keyPoints2.map(x => x.map(p => `G1 X${p[0]} Y${p[1]} F${params.feedRate}`));\n  // console.log(gcodePoints2)\n  // gcodePoints2 = gcodePoints2.flat(1);\n\n  // let gcode = JSON.parse(JSON.stringify(gcodePoints));\n  // let gcode2 = JSON.parse(JSON.stringify(gcodePoints2));\n\n  //console.log(gcode2);\n\n  let firstPoint = keyPoints[0];\n  let firstPoints2 = keyPoints2.map(x => x[0]);\n  // console.log(firstPoints2)\n\n  let paths = params.depthOfPasses.map((p,i) => [\n    `G1 Z${params.depthOfPasses[i]} F12.0`,\n    ...gcodePoints,\n    `G1 X${firstPoint[0]} Y${firstPoint[1]} F${params.feedRate}`\n  ])\n  paths = paths.flat(1);\n\n  let paths2 = gcodePoints2.map((p, i) => [\n    ...p,\n    `G1 X${firstPoints2[i][0]} Y${firstPoints2[i][1]} F${params.feedRate}`\n  ])\n  paths2 = paths2.flat(1);\n  //console.log(paths2)\n\n  let paths3 = params.depthOfPasses.map((p,i) => [\n    `G1 Z${params.depthOfPasses[i]} F12.0`,\n    ...paths2,\n  ])\n  paths3 = paths3.flat(1);\n\n  // console.log(paths3)\n\n  let gcode = [\n    params.units,\n    \"G90\",\n    `G1 Z${params.jogHeight} F9.0`,\n    `G0 X${firstPoint[0]} Y${firstPoint[1]}`,\n    ...paths\n  ]\n\n  let gcode2 = [\n    params.units,\n    \"G90\",\n    `G1 Z${params.jogHeight} F9.0`,\n    `G0 X${firstPoints2[0][0]} Y${firstPoints2[0][1]}`,\n    ...paths3,\n    `G1 Z${params.jogHeight} F9.0`,\n  ]\n\n  // write to a new file named\n  let filename = 'testGcodePocket.nc';\n\n  let text = gcode2.join('\\n');\n\n  return {drawing: outlines, gcode: text, filename};\n};\n\n\nexport {pocket};\n"]},"metadata":{},"sourceType":"module"}