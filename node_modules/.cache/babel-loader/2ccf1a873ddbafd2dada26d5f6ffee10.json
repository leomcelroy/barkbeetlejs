{"ast":null,"code":"/* Copyright 2013 Google Inc. All Rights Reserved.\n\n   Licensed under the Apache License, Version 2.0 (the \"License\");\n   you may not use this file except in compliance with the License.\n   You may obtain a copy of the License at\n\n   http://www.apache.org/licenses/LICENSE-2.0\n\n   Unless required by applicable law or agreed to in writing, software\n   distributed under the License is distributed on an \"AS IS\" BASIS,\n   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n   See the License for the specific language governing permissions and\n   limitations under the License.\n\n   Transformations on dictionary words.\n*/\nvar BrotliDictionary = require('./dictionary');\n\nvar kIdentity = 0;\nvar kOmitLast1 = 1;\nvar kOmitLast2 = 2;\nvar kOmitLast3 = 3;\nvar kOmitLast4 = 4;\nvar kOmitLast5 = 5;\nvar kOmitLast6 = 6;\nvar kOmitLast7 = 7;\nvar kOmitLast8 = 8;\nvar kOmitLast9 = 9;\nvar kUppercaseFirst = 10;\nvar kUppercaseAll = 11;\nvar kOmitFirst1 = 12;\nvar kOmitFirst2 = 13;\nvar kOmitFirst3 = 14;\nvar kOmitFirst4 = 15;\nvar kOmitFirst5 = 16;\nvar kOmitFirst6 = 17;\nvar kOmitFirst7 = 18;\nvar kOmitFirst8 = 19;\nvar kOmitFirst9 = 20;\n\nfunction Transform(prefix, transform, suffix) {\n  this.prefix = new Uint8Array(prefix.length);\n  this.transform = transform;\n  this.suffix = new Uint8Array(suffix.length);\n\n  for (var i = 0; i < prefix.length; i++) {\n    this.prefix[i] = prefix.charCodeAt(i);\n  }\n\n  for (var i = 0; i < suffix.length; i++) {\n    this.suffix[i] = suffix.charCodeAt(i);\n  }\n}\n\nvar kTransforms = [new Transform(\"\", kIdentity, \"\"), new Transform(\"\", kIdentity, \" \"), new Transform(\" \", kIdentity, \" \"), new Transform(\"\", kOmitFirst1, \"\"), new Transform(\"\", kUppercaseFirst, \" \"), new Transform(\"\", kIdentity, \" the \"), new Transform(\" \", kIdentity, \"\"), new Transform(\"s \", kIdentity, \" \"), new Transform(\"\", kIdentity, \" of \"), new Transform(\"\", kUppercaseFirst, \"\"), new Transform(\"\", kIdentity, \" and \"), new Transform(\"\", kOmitFirst2, \"\"), new Transform(\"\", kOmitLast1, \"\"), new Transform(\", \", kIdentity, \" \"), new Transform(\"\", kIdentity, \", \"), new Transform(\" \", kUppercaseFirst, \" \"), new Transform(\"\", kIdentity, \" in \"), new Transform(\"\", kIdentity, \" to \"), new Transform(\"e \", kIdentity, \" \"), new Transform(\"\", kIdentity, \"\\\"\"), new Transform(\"\", kIdentity, \".\"), new Transform(\"\", kIdentity, \"\\\">\"), new Transform(\"\", kIdentity, \"\\n\"), new Transform(\"\", kOmitLast3, \"\"), new Transform(\"\", kIdentity, \"]\"), new Transform(\"\", kIdentity, \" for \"), new Transform(\"\", kOmitFirst3, \"\"), new Transform(\"\", kOmitLast2, \"\"), new Transform(\"\", kIdentity, \" a \"), new Transform(\"\", kIdentity, \" that \"), new Transform(\" \", kUppercaseFirst, \"\"), new Transform(\"\", kIdentity, \". \"), new Transform(\".\", kIdentity, \"\"), new Transform(\" \", kIdentity, \", \"), new Transform(\"\", kOmitFirst4, \"\"), new Transform(\"\", kIdentity, \" with \"), new Transform(\"\", kIdentity, \"'\"), new Transform(\"\", kIdentity, \" from \"), new Transform(\"\", kIdentity, \" by \"), new Transform(\"\", kOmitFirst5, \"\"), new Transform(\"\", kOmitFirst6, \"\"), new Transform(\" the \", kIdentity, \"\"), new Transform(\"\", kOmitLast4, \"\"), new Transform(\"\", kIdentity, \". The \"), new Transform(\"\", kUppercaseAll, \"\"), new Transform(\"\", kIdentity, \" on \"), new Transform(\"\", kIdentity, \" as \"), new Transform(\"\", kIdentity, \" is \"), new Transform(\"\", kOmitLast7, \"\"), new Transform(\"\", kOmitLast1, \"ing \"), new Transform(\"\", kIdentity, \"\\n\\t\"), new Transform(\"\", kIdentity, \":\"), new Transform(\" \", kIdentity, \". \"), new Transform(\"\", kIdentity, \"ed \"), new Transform(\"\", kOmitFirst9, \"\"), new Transform(\"\", kOmitFirst7, \"\"), new Transform(\"\", kOmitLast6, \"\"), new Transform(\"\", kIdentity, \"(\"), new Transform(\"\", kUppercaseFirst, \", \"), new Transform(\"\", kOmitLast8, \"\"), new Transform(\"\", kIdentity, \" at \"), new Transform(\"\", kIdentity, \"ly \"), new Transform(\" the \", kIdentity, \" of \"), new Transform(\"\", kOmitLast5, \"\"), new Transform(\"\", kOmitLast9, \"\"), new Transform(\" \", kUppercaseFirst, \", \"), new Transform(\"\", kUppercaseFirst, \"\\\"\"), new Transform(\".\", kIdentity, \"(\"), new Transform(\"\", kUppercaseAll, \" \"), new Transform(\"\", kUppercaseFirst, \"\\\">\"), new Transform(\"\", kIdentity, \"=\\\"\"), new Transform(\" \", kIdentity, \".\"), new Transform(\".com/\", kIdentity, \"\"), new Transform(\" the \", kIdentity, \" of the \"), new Transform(\"\", kUppercaseFirst, \"'\"), new Transform(\"\", kIdentity, \". This \"), new Transform(\"\", kIdentity, \",\"), new Transform(\".\", kIdentity, \" \"), new Transform(\"\", kUppercaseFirst, \"(\"), new Transform(\"\", kUppercaseFirst, \".\"), new Transform(\"\", kIdentity, \" not \"), new Transform(\" \", kIdentity, \"=\\\"\"), new Transform(\"\", kIdentity, \"er \"), new Transform(\" \", kUppercaseAll, \" \"), new Transform(\"\", kIdentity, \"al \"), new Transform(\" \", kUppercaseAll, \"\"), new Transform(\"\", kIdentity, \"='\"), new Transform(\"\", kUppercaseAll, \"\\\"\"), new Transform(\"\", kUppercaseFirst, \". \"), new Transform(\" \", kIdentity, \"(\"), new Transform(\"\", kIdentity, \"ful \"), new Transform(\" \", kUppercaseFirst, \". \"), new Transform(\"\", kIdentity, \"ive \"), new Transform(\"\", kIdentity, \"less \"), new Transform(\"\", kUppercaseAll, \"'\"), new Transform(\"\", kIdentity, \"est \"), new Transform(\" \", kUppercaseFirst, \".\"), new Transform(\"\", kUppercaseAll, \"\\\">\"), new Transform(\" \", kIdentity, \"='\"), new Transform(\"\", kUppercaseFirst, \",\"), new Transform(\"\", kIdentity, \"ize \"), new Transform(\"\", kUppercaseAll, \".\"), new Transform(\"\\xc2\\xa0\", kIdentity, \"\"), new Transform(\" \", kIdentity, \",\"), new Transform(\"\", kUppercaseFirst, \"=\\\"\"), new Transform(\"\", kUppercaseAll, \"=\\\"\"), new Transform(\"\", kIdentity, \"ous \"), new Transform(\"\", kUppercaseAll, \", \"), new Transform(\"\", kUppercaseFirst, \"='\"), new Transform(\" \", kUppercaseFirst, \",\"), new Transform(\" \", kUppercaseAll, \"=\\\"\"), new Transform(\" \", kUppercaseAll, \", \"), new Transform(\"\", kUppercaseAll, \",\"), new Transform(\"\", kUppercaseAll, \"(\"), new Transform(\"\", kUppercaseAll, \". \"), new Transform(\" \", kUppercaseAll, \".\"), new Transform(\"\", kUppercaseAll, \"='\"), new Transform(\" \", kUppercaseAll, \". \"), new Transform(\" \", kUppercaseFirst, \"=\\\"\"), new Transform(\" \", kUppercaseAll, \"='\"), new Transform(\" \", kUppercaseFirst, \"='\")];\nexports.kTransforms = kTransforms;\nexports.kNumTransforms = kTransforms.length;\n\nfunction ToUpperCase(p, i) {\n  if (p[i] < 0xc0) {\n    if (p[i] >= 97 && p[i] <= 122) {\n      p[i] ^= 32;\n    }\n\n    return 1;\n  }\n  /* An overly simplified uppercasing model for utf-8. */\n\n\n  if (p[i] < 0xe0) {\n    p[i + 1] ^= 32;\n    return 2;\n  }\n  /* An arbitrary transform for three byte characters. */\n\n\n  p[i + 2] ^= 5;\n  return 3;\n}\n\nexports.transformDictionaryWord = function (dst, idx, word, len, transform) {\n  var prefix = kTransforms[transform].prefix;\n  var suffix = kTransforms[transform].suffix;\n  var t = kTransforms[transform].transform;\n  var skip = t < kOmitFirst1 ? 0 : t - (kOmitFirst1 - 1);\n  var i = 0;\n  var start_idx = idx;\n  var uppercase;\n\n  if (skip > len) {\n    skip = len;\n  }\n\n  var prefix_pos = 0;\n\n  while (prefix_pos < prefix.length) {\n    dst[idx++] = prefix[prefix_pos++];\n  }\n\n  word += skip;\n  len -= skip;\n\n  if (t <= kOmitLast9) {\n    len -= t;\n  }\n\n  for (i = 0; i < len; i++) {\n    dst[idx++] = BrotliDictionary.dictionary[word + i];\n  }\n\n  uppercase = idx - len;\n\n  if (t === kUppercaseFirst) {\n    ToUpperCase(dst, uppercase);\n  } else if (t === kUppercaseAll) {\n    while (len > 0) {\n      var step = ToUpperCase(dst, uppercase);\n      uppercase += step;\n      len -= step;\n    }\n  }\n\n  var suffix_pos = 0;\n\n  while (suffix_pos < suffix.length) {\n    dst[idx++] = suffix[suffix_pos++];\n  }\n\n  return idx - start_idx;\n};","map":null,"metadata":{},"sourceType":"script"}