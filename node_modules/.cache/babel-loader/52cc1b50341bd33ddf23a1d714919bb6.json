{"ast":null,"code":"import _objectSpread from \"/Users/leomcelroy/Desktop/barkbeetle_js/node_modules/@babel/runtime/helpers/esm/objectSpread\";\nimport * as mjs from 'makerjs';\nimport * as s2p from 'shape2path';\nimport * as svgson from 'svgson';\nimport * as utils from './utils.js';\nimport { flattenSVG } from 'flatten-svg';\nimport store from \"./store.js\"; //this is my global state library, this is the only file that will getState() it will pass that to all sub components or should i import store in respective components\n\nvar uploadSVGFlatten = function uploadSVGFlatten(e) {\n  var parseSvg = function parseSvg(svg) {\n    var window = new Window();\n    window.document.documentElement.innerHTML = svg;\n    return window.document.documentElement;\n  }; //main event\n\n\n  var files = e.target.files;\n  var file = files[0];\n  var reader = new FileReader();\n\n  reader.onload = function (event) {\n    var text = event.target.result;\n    var paths = flattenSVG(parseSVG(text));\n    console.log(paths);\n  };\n\n  reader.readAsText(file);\n};\n\nvar uploadSVG = function uploadSVG(e) {\n  uploadSVGFlatten(e); //helper function\n\n  var replaceWithPath = function replaceWithPath(child) {\n    //TODO: why cant I put this in a different file\n    // console.log(\"child\", child);\n    // console.log(\"child name\", child.name);\n    if (child.name === \"g\" || child.name === \"defs\") {\n      return child.children.map(function (grandchild) {\n        return replaceWithPath(grandchild);\n      });\n    }\n\n    if (child.name === \"rectangle\" || child.name === \"rect\") {\n      var x = child.attributes.x;\n      var y = child.attributes.y;\n      var width = child.attributes.width;\n      var height = child.attributes.heigth;\n      var rx = child.attributes.rx;\n      var ry = child.attributes.ry;\n      if (child.name === \"rect\") height = child.attributes.height; //TODO: HACK: no idea why I need to do this\n\n      var temp = s2p.rect({\n        x: x,\n        y: y,\n        width: width,\n        height: height,\n        rx: rx,\n        ry: ry\n      });\n      return mjs.importer.fromSVGPathData(temp);\n    }\n\n    if (child.name === \"circle\") {\n      var cx = child.attributes.cx;\n      var cy = child.attributes.cy;\n      var r = child.attributes.r;\n\n      var _temp = s2p.rect({\n        cx: cx,\n        cy: cy,\n        r: r\n      });\n\n      return mjs.importer.fromSVGPathData(_temp);\n    }\n\n    if (child.name === \"ellipse\") {\n      var _cx = child.attributes.cx;\n      var _cy = child.attributes.cy;\n      var _rx = child.attributes.rx;\n      var _ry = child.attributes.ry;\n\n      var _temp2 = s2p.ellipse({\n        cx: _cx,\n        cy: _cy,\n        rx: _rx,\n        ry: _ry\n      });\n\n      return mjs.importer.fromSVGPathData(_temp2);\n    }\n\n    if (child.name === \"polygon\") {\n      var points = child.attributes.points;\n\n      var _temp3 = s2p.polygon({\n        points: points\n      });\n\n      return mjs.importer.fromSVGPathData(_temp3);\n    }\n\n    if (child.name === \"polyline\") {\n      var _points = child.attributes.points;\n\n      var _temp4 = s2p.polyline({\n        points: _points\n      });\n\n      return mjs.importer.fromSVGPathData(_temp4);\n    }\n\n    if (child.name === \"line\") {\n      var x1 = child.attributes.x1;\n      var x2 = child.attributes.x2;\n      var y1 = child.attributes.y1;\n      var y2 = child.attributes.y2;\n\n      var _temp5 = s2p.line({\n        x1: x1,\n        x2: x2,\n        y1: y1,\n        y2: y2\n      });\n\n      return mjs.importer.fromSVGPathData(_temp5);\n    }\n\n    if (child.name === \"path\") {\n      console.log(child);\n      var makerjsPath = mjs.importer.fromSVGPathData(child.attributes.d);\n      console.log(\"mjspath\", makerjsPath);\n      return makerjsPath;\n    }\n  }; //main event\n\n\n  var files = e.target.files;\n  var file = files[0];\n  var reader = new FileReader();\n\n  reader.onload = function (event) {\n    var text = event.target.result;\n    svgson.parse(text).then(function (json) {\n      var svg = json.children.map(function (child) {\n        return replaceWithPath(child);\n      });\n      console.log(svg);\n      svg = svg.flat(1); //TODO: what does the argument do again?\n      //TODO: update state to have makerjs models\n      //console.log(\"svg\", svg);\n\n      var models = {};\n      svg.forEach(function (shape) {\n        if (Array.isArray(shape)) {\n          shape.filter(function (entry) {\n            return typeof entry === \"object\";\n          }).forEach(function (entry) {\n            shape = entry[0];\n          });\n        }\n\n        ; //TODO: HACK\n\n        console.log(\"shape\", shape);\n        var chains = mjs.model.findChains(shape);\n        if (chains === undefined) return; //TODO: HACK\n\n        chains.forEach(function (chain) {\n          models[utils.makeID()] = mjs.chain.toNewModel(chain);\n        }); //  models[utils.makeID()] = shape;\n      }); // console.log(\"models\", models);\n\n      var newShapes = _objectSpread({}, store.state.shapes, models);\n\n      store.update({\n        shapes: newShapes\n      }); //ultimately I will set state of app\n    });\n  };\n\n  reader.readAsText(file);\n};\n\nexport { uploadSVG };","map":{"version":3,"sources":["/Users/leomcelroy/Desktop/barkbeetle_js/src/uploadSVG.js"],"names":["mjs","s2p","svgson","utils","flattenSVG","store","uploadSVGFlatten","e","parseSvg","svg","window","Window","document","documentElement","innerHTML","files","target","file","reader","FileReader","onload","event","text","result","paths","parseSVG","console","log","readAsText","uploadSVG","replaceWithPath","child","name","children","map","grandchild","x","attributes","y","width","height","heigth","rx","ry","temp","rect","importer","fromSVGPathData","cx","cy","r","ellipse","points","polygon","polyline","x1","x2","y1","y2","line","makerjsPath","d","parse","then","json","flat","models","forEach","shape","Array","isArray","filter","entry","chains","model","findChains","undefined","chain","makeID","toNewModel","newShapes","state","shapes","update"],"mappings":"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","sourcesContent":["import * as mjs from 'makerjs';\nimport * as s2p from 'shape2path';\nimport * as svgson from 'svgson';\nimport * as utils from './utils.js';\nimport {flattenSVG} from 'flatten-svg';\n\nimport store from \"./store.js\"; //this is my global state library, this is the only file that will getState() it will pass that to all sub components or should i import store in respective components\n\n\n\nconst uploadSVGFlatten = (e) => {\n  const parseSvg = (svg) => {\n    const window = new Window\n    window.document.documentElement.innerHTML = svg\n    return window.document.documentElement\n  }\n\n  //main event\n  let files = e.target.files;\n  let file = files[0];\n\n  var reader = new FileReader();\n\n  reader.onload = (event) => {\n    let text = event.target.result;\n\n    let paths = flattenSVG(parseSVG(text));\n\n    console.log(paths);\n  };\n\n  reader.readAsText(file);\n}\n\nconst uploadSVG = (e) => {\n  uploadSVGFlatten(e);\n  //helper function\n  const replaceWithPath = (child) => { //TODO: why cant I put this in a different file\n    // console.log(\"child\", child);\n    // console.log(\"child name\", child.name);\n\n    if (child.name === \"g\" || child.name === \"defs\") {\n      return child.children.map(grandchild => replaceWithPath(grandchild));\n    }\n\n    if (child.name === \"rectangle\" || child.name === \"rect\") {\n      let x = child.attributes.x;\n      let y = child.attributes.y;\n      let width = child.attributes.width;\n      let height = child.attributes.heigth;\n      let rx = child.attributes.rx;\n      let ry = child.attributes.ry;\n\n\n      if (child.name === \"rect\") height = child.attributes.height; //TODO: HACK: no idea why I need to do this\n\n      let temp = s2p.rect({x, y, width, height, rx, ry});\n      return mjs.importer.fromSVGPathData(temp);\n    }\n\n    if (child.name === \"circle\") {\n      let cx = child.attributes.cx;\n      let cy = child.attributes.cy;\n      let r = child.attributes.r;\n\n      let temp = s2p.rect({cx, cy, r});\n      return mjs.importer.fromSVGPathData(temp);\n    }\n\n    if (child.name === \"ellipse\") {\n      let cx = child.attributes.cx;\n      let cy = child.attributes.cy;\n      let rx = child.attributes.rx;\n      let ry = child.attributes.ry;\n\n      let temp = s2p.ellipse({cx, cy, rx, ry});\n      return mjs.importer.fromSVGPathData(temp);\n    }\n\n    if (child.name === \"polygon\") {\n      let points = child.attributes.points;\n\n      let temp = s2p.polygon({points});\n      return mjs.importer.fromSVGPathData(temp);\n    }\n\n    if (child.name === \"polyline\") {\n      let points = child.attributes.points;\n\n      let temp = s2p.polyline({points});\n      return mjs.importer.fromSVGPathData(temp);\n    }\n\n    if (child.name === \"line\") {\n      let x1 = child.attributes.x1;\n      let x2 = child.attributes.x2;\n      let y1 = child.attributes.y1;\n      let y2 = child.attributes.y2;\n\n      let temp = s2p.line({x1, x2, y1, y2});\n      return mjs.importer.fromSVGPathData(temp);\n    }\n\n    if (child.name === \"path\") {\n      console.log(child);\n      let makerjsPath = mjs.importer.fromSVGPathData(child.attributes.d);\n      console.log(\"mjspath\", makerjsPath);\n      return makerjsPath;\n    }\n  }\n\n  //main event\n  let files = e.target.files;\n  let file = files[0];\n\n  var reader = new FileReader();\n\n  reader.onload = (event) => {\n    let text = event.target.result;\n\n    svgson.parse(text).then((json) => {\n      let svg = json.children.map(child => {\n        return replaceWithPath(child);\n      });\n\n      console.log(svg);\n\n      svg = svg.flat(1); //TODO: what does the argument do again?\n\n      //TODO: update state to have makerjs models\n      //console.log(\"svg\", svg);\n      let models = {};\n\n      svg.forEach(shape => {\n        if (Array.isArray(shape)) {\n          shape.filter(entry => typeof entry === \"object\")\n               .forEach(entry => {\n                 shape = entry[0];\n               })\n        }; //TODO: HACK\n\n        console.log(\"shape\", shape);\n\n        let chains = mjs.model.findChains(shape);\n\n        if (chains === undefined) return //TODO: HACK\n\n        chains.forEach(chain => {\n          models[utils.makeID()] = mjs.chain.toNewModel(chain);\n        })\n\n      //  models[utils.makeID()] = shape;\n\n      })\n\n      // console.log(\"models\", models);\n\n      let newShapes = {...store.state.shapes, ...models}\n\n      store.update({shapes: newShapes});\n\n      //ultimately I will set state of app\n    });\n  };\n\n  reader.readAsText(file);\n}\n\nexport {uploadSVG};\n"]},"metadata":{},"sourceType":"module"}