{"ast":null,"code":"import _toConsumableArray from \"/Users/leomcelroy/Desktop/barkBeetleEverything/barkbeetle_js_real/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\n// makerjs model, depth, params -> pocket toolpath\nimport * as mjs from 'makerjs';\nvar STRANGE_CORRECTION = 0.0000001;\n\nvar intToolPath = function intToolPath(geo, radius) {\n  try {\n    return mjs.model.outline(geo, radius, 1, true);\n  } catch (_unused) {\n    return false;\n  }\n};\n\nvar intToolPaths = function intToolPaths(geo, radius) {\n  var first = intToolPath(geo, radius);\n\n  if (first === false) {\n    return false;\n  }\n\n  var model = {};\n  var count = 0;\n  model[count] = intToolPath(geo, radius);\n  count++;\n\n  while (intToolPath(model[count - 1], radius)) {\n    console.log(count);\n    model[count] = intToolPath(model[count - 1], radius);\n    count++;\n  }\n\n  return model;\n};\n\nvar pocket = function pocket(model, params) {\n  //let p = model.models.profile;\n  var p = model; // let outline = mjs.model.outline(p, params.compensatedRadius, 1, true); //third parameter is what type of corners, 0 (rounded) by default\n\n  var outline = intToolPath(p, params.compensatedRadius + STRANGE_CORRECTION);\n  var outlines = intToolPaths(p, params.compensatedRadius + STRANGE_CORRECTION);\n\n  if (outline !== true) {\n    return {\n      drawing: {\n        models: {}\n      },\n      gcode: '',\n      filename: \"null\"\n    };\n  } //let chains = mjs.model.findChains(expansion);\n\n\n  var chain = mjs.model.findSingleChain(outline);\n  var divisions = Math.floor(chain.pathLength / params.minimumSpacing);\n  var spacing = chain.pathLength / divisions;\n  var keyPoints = mjs.chain.toPoints(chain, spacing); // let scaleFactor = 10;\n  // let scaleXY = keyPoints.map(p => [p[0] * scaleFactor, p[1] * scaleFactor]);\n\n  var gcodePoints = keyPoints.map(function (p) {\n    return \"G1 X\".concat(p[0], \" Y\").concat(p[1], \" F\").concat(params.feedRate);\n  });\n  var gcode = JSON.parse(JSON.stringify(gcodePoints));\n  var firstPoint = keyPoints[0];\n  var paths = params.depthOfPasses.map(function (p, i) {\n    return [\"G1 Z\".concat(params.depthOfPasses[i], \" F12.0\")].concat(_toConsumableArray(gcode), [\"G1 X\".concat(firstPoint[0], \" Y\").concat(firstPoint[1], \" F\").concat(params.feedRate)]);\n  });\n  paths = paths.flat(1);\n  gcode = [params.units, \"G90\", \"G1 Z\".concat(params.jogHeight, \" F9.0\"), \"G0 X\".concat(firstPoint[0], \" Y\").concat(firstPoint[1])].concat(_toConsumableArray(paths)); // write to a new file named\n\n  var filename = 'testGcodePocket.nc';\n  var text = gcode.join('\\n'); //testing\n  // console.log(\"pocket\", outline);\n\n  var o2 = intToolPath(outline);\n  var oModel = {\n    models: {\n      outline: outline,\n      o2: o2\n    }\n  };\n  return {\n    drawing: oModel,\n    gcode: text,\n    filename: filename\n  };\n};\n\nexport { pocket };","map":{"version":3,"sources":["/Users/leomcelroy/Desktop/barkBeetleEverything/barkbeetle_js_real/src/toolpaths/pocket.js"],"names":["mjs","STRANGE_CORRECTION","intToolPath","geo","radius","model","outline","intToolPaths","first","count","console","log","pocket","params","p","compensatedRadius","outlines","drawing","models","gcode","filename","chain","findSingleChain","divisions","Math","floor","pathLength","minimumSpacing","spacing","keyPoints","toPoints","gcodePoints","map","feedRate","JSON","parse","stringify","firstPoint","paths","depthOfPasses","i","flat","units","jogHeight","text","join","o2","oModel"],"mappings":"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","sourcesContent":["// makerjs model, depth, params -> pocket toolpath\nimport * as mjs from 'makerjs';\n\nconst STRANGE_CORRECTION = 0.0000001;\n\nconst intToolPath = (geo, radius) => {\n  try {\n    return mjs.model.outline(geo, radius, 1, true);\n  }\n  catch {\n    return false\n  }\n}\n\nconst intToolPaths = (geo, radius) => {\n  let first = intToolPath(geo, radius);\n  if (first === false) {return false}\n\n  let model = {}\n  let count = 0;\n\n  model[count] = intToolPath(geo, radius);\n\n  count++;\n\n  while (intToolPath(model[count-1], radius)) {\n    console.log(count);\n    model[count] = intToolPath(model[count-1], radius);\n    count++;\n  }\n\n  return model;\n}\n\nconst pocket = (model, params) => {\n  //let p = model.models.profile;\n  let p = model;\n\n  // let outline = mjs.model.outline(p, params.compensatedRadius, 1, true); //third parameter is what type of corners, 0 (rounded) by default\n  let outline = intToolPath(p, params.compensatedRadius + STRANGE_CORRECTION);\n  let outlines = intToolPaths(p, params.compensatedRadius + STRANGE_CORRECTION);\n\n  if (outline !== true) {\n    return {drawing: {models:{}}, gcode: '', filename: \"null\"}\n  }\n\n  //let chains = mjs.model.findChains(expansion);\n  let chain = mjs.model.findSingleChain(outline);\n\n  var divisions = Math.floor(chain.pathLength / params.minimumSpacing);\n  var spacing = chain.pathLength / divisions;\n\n  let keyPoints = mjs.chain.toPoints(chain, spacing);\n\n  // let scaleFactor = 10;\n  // let scaleXY = keyPoints.map(p => [p[0] * scaleFactor, p[1] * scaleFactor]);\n\n  let gcodePoints = keyPoints.map(p => `G1 X${p[0]} Y${p[1]} F${params.feedRate}`)\n  let gcode = JSON.parse(JSON.stringify(gcodePoints));\n\n  let firstPoint = keyPoints[0];\n\n  let paths = params.depthOfPasses.map((p,i) => [`G1 Z${params.depthOfPasses[i]} F12.0`, ...gcode, `G1 X${firstPoint[0]} Y${firstPoint[1]} F${params.feedRate}`])\n  paths = paths.flat(1);\n\n  gcode = [\n    params.units,\n    \"G90\",\n    `G1 Z${params.jogHeight} F9.0`,\n    `G0 X${firstPoint[0]} Y${firstPoint[1]}`,\n    ...paths\n  ]\n\n  // write to a new file named\n  let filename = 'testGcodePocket.nc';\n\n  let text = gcode.join('\\n');\n\n  //testing\n  // console.log(\"pocket\", outline);\n\n  let o2 = intToolPath(outline);\n  let oModel = {\n    models:{\n      outline,\n      o2\n    }\n  }\n\n  return {drawing: oModel, gcode: text, filename};\n};\n\n\nexport {pocket};\n"]},"metadata":{},"sourceType":"module"}