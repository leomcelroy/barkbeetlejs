{"ast":null,"code":"(function () {\n  var computeScore, countDir, file_coeff, getExtension, _getExtensionScore, isMatch, scorePath, scoreSize, tau_depth, _ref;\n\n  _ref = require('./scorer'), isMatch = _ref.isMatch, computeScore = _ref.computeScore, scoreSize = _ref.scoreSize;\n  tau_depth = 20;\n  file_coeff = 2.5;\n\n  exports.score = function (string, query, options) {\n    var allowErrors, preparedQuery, score, string_lw;\n    preparedQuery = options.preparedQuery, allowErrors = options.allowErrors;\n\n    if (!(allowErrors || isMatch(string, preparedQuery.core_lw, preparedQuery.core_up))) {\n      return 0;\n    }\n\n    string_lw = string.toLowerCase();\n    score = computeScore(string, string_lw, preparedQuery);\n    score = scorePath(string, string_lw, score, options);\n    return Math.ceil(score);\n  };\n\n  scorePath = function scorePath(subject, subject_lw, fullPathScore, options) {\n    var alpha, basePathScore, basePos, depth, end, extAdjust, fileLength, pathSeparator, preparedQuery, useExtensionBonus;\n\n    if (fullPathScore === 0) {\n      return 0;\n    }\n\n    preparedQuery = options.preparedQuery, useExtensionBonus = options.useExtensionBonus, pathSeparator = options.pathSeparator;\n    end = subject.length - 1;\n\n    while (subject[end] === pathSeparator) {\n      end--;\n    }\n\n    basePos = subject.lastIndexOf(pathSeparator, end);\n    fileLength = end - basePos;\n    extAdjust = 1.0;\n\n    if (useExtensionBonus) {\n      extAdjust += _getExtensionScore(subject_lw, preparedQuery.ext, basePos, end, 2);\n      fullPathScore *= extAdjust;\n    }\n\n    if (basePos === -1) {\n      return fullPathScore;\n    }\n\n    depth = preparedQuery.depth;\n\n    while (basePos > -1 && depth-- > 0) {\n      basePos = subject.lastIndexOf(pathSeparator, basePos - 1);\n    }\n\n    basePathScore = basePos === -1 ? fullPathScore : extAdjust * computeScore(subject.slice(basePos + 1, end + 1), subject_lw.slice(basePos + 1, end + 1), preparedQuery);\n    alpha = 0.5 * tau_depth / (tau_depth + countDir(subject, end + 1, pathSeparator));\n    return alpha * basePathScore + (1 - alpha) * fullPathScore * scoreSize(0, file_coeff * fileLength);\n  };\n\n  exports.countDir = countDir = function countDir(path, end, pathSeparator) {\n    var count, i;\n\n    if (end < 1) {\n      return 0;\n    }\n\n    count = 0;\n    i = -1;\n\n    while (++i < end && path[i] === pathSeparator) {\n      continue;\n    }\n\n    while (++i < end) {\n      if (path[i] === pathSeparator) {\n        count++;\n\n        while (++i < end && path[i] === pathSeparator) {\n          continue;\n        }\n      }\n    }\n\n    return count;\n  };\n\n  exports.getExtension = getExtension = function getExtension(str) {\n    var pos;\n    pos = str.lastIndexOf(\".\");\n\n    if (pos < 0) {\n      return \"\";\n    } else {\n      return str.substr(pos + 1);\n    }\n  };\n\n  _getExtensionScore = function getExtensionScore(candidate, ext, startPos, endPos, maxDepth) {\n    var m, matched, n, pos;\n\n    if (!ext.length) {\n      return 0;\n    }\n\n    pos = candidate.lastIndexOf(\".\", endPos);\n\n    if (!(pos > startPos)) {\n      return 0;\n    }\n\n    n = ext.length;\n    m = endPos - pos;\n\n    if (m < n) {\n      n = m;\n      m = ext.length;\n    }\n\n    pos++;\n    matched = -1;\n\n    while (++matched < n) {\n      if (candidate[pos + matched] !== ext[matched]) {\n        break;\n      }\n    }\n\n    if (matched === 0 && maxDepth > 0) {\n      return 0.9 * _getExtensionScore(candidate, ext, startPos, pos - 2, maxDepth - 1);\n    }\n\n    return matched / m;\n  };\n}).call(this);","map":null,"metadata":{},"sourceType":"script"}