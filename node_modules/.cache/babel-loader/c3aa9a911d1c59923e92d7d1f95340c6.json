{"ast":null,"code":"import _toConsumableArray from \"/Users/leomcelroy/Desktop/barkbeetle_js/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\n// makerjs model, depth, params -> pocket toolpath\nimport { clipOffsetContour } from '../unmakerjs/clipper.js';\n\nvar len = function len(toolpath) {\n  return Object.keys(toolpath).length;\n};\n\nvar isToolpath = function isToolpath(toolpath) {\n  // console.log(\"toolpath\", toolpath);\n  if (len(toolpath) >= 1) {\n    return true;\n  } else {\n    return false;\n  }\n};\n\nvar createToolpaths = function createToolpaths(geo, params) {\n  var contours = [];\n  var count = 0;\n  var pass = clipOffsetContour(geo, -params.compensatedRadius); //returns array of contours\n\n  if (isToolpath(pass) !== true) {\n    return contours;\n  }\n\n  while (isToolpath(pass)) {\n    contours.push(pass);\n    count++;\n    var lastPass = contours[count - 1]; // console.log(\"lastPass\", lastPass)\n\n    pass = lastPass.map(function (contour) {\n      return clipOffsetContour(contour, -params.compensatedRadius * params.stepoverPercentage / 100);\n    }).flat();\n  }\n\n  return contours.flat();\n};\n\nexport var pocketGcode = function pocketGcode(toolpaths, params) {\n  var keyPoints = toolpaths.map(function (outline) {\n    return outline.map(function (line) {\n      return [line.origin[0], line.origin[1]];\n    });\n  }); // toolpaths = Object.values(toolpaths).flat(2);\n  // console.log(\"toolpaths\", toolpaths);\n  // console.log(\"keyPoints\", keyPoints);\n\n  var gcodePoints = keyPoints.map(function (points) {\n    var raise = points.length > 1;\n    var firstPoint = points[0];\n    firstPoint = \"G1 X\".concat(firstPoint[0], \" Y\").concat(firstPoint[1], \" F\").concat(params.feedRate);\n\n    if (raise) {\n      return [\"G1 Z\".concat(params.jogHeight, \" F\").concat(params.jogRate), firstPoint, //want to jog to this one\n      \"plunge\"].concat(_toConsumableArray(points.map(function (point) {\n        return \"G1 X\".concat(point[0], \" Y\").concat(point[1], \" F\").concat(params.feedRate);\n      })), [firstPoint, \"G1 Z\".concat(params.jogHeight, \" F\").concat(params.jogRate)]);\n    } else {\n      return [firstPoint, \"plunge\"].concat(_toConsumableArray(points.map(function (point) {\n        return \"G1 X\".concat(point[0], \" Y\").concat(point[1], \" F\").concat(params.feedRate);\n      })), [firstPoint]);\n    }\n  });\n  var paths = gcodePoints.flat(); // let firstPoint = keyPoints[0][0][0];\n\n  var passDepths = params.depthOfPasses(params.cutDepth, params.passDepth);\n  var paths2 = params.depthOfPasses(params.cutDepth, params.passDepth).map(function (p, i) {\n    return _toConsumableArray(paths.map(function (x) {\n      return x === \"plunge\" ? \"G1 Z\".concat(params.depthOfPasses[i], \" F\").concat(params.plungeRate) : x;\n    }));\n  }); // console.log(paths2)\n\n  paths2 = paths2.flat();\n  var units;\n  if (params.units === \"in\") units = \"G20\";\n  if (params.units === \"mm\") units = \"G21\";\n  var preamble = [units, \"G90\"];\n  var gcode = [].concat(preamble, [\"(end of preamble)\", \"G1 Z\".concat(params.jogHeight, \" F\").concat(params.jogRate)], _toConsumableArray(paths2), [\"G1 Z\".concat(params.jogHeight, \" F\").concat(params.jogRate)]);\n  var text = gcode.join('\\n');\n  return text;\n};\nexport var pocket = function pocket(contour, params) {\n  var toolpaths = createToolpaths(contour, params); //let gcode = pocketGcode(toolpaths, params)\n\n  return {\n    drawing: toolpaths,\n    geometry: toolpaths\n  };\n};","map":{"version":3,"sources":["/Users/leomcelroy/Desktop/barkbeetle_js/src/toolpaths/pocket.js"],"names":["clipOffsetContour","len","toolpath","Object","keys","length","isToolpath","createToolpaths","geo","params","contours","count","pass","compensatedRadius","push","lastPass","map","contour","stepoverPercentage","flat","pocketGcode","toolpaths","keyPoints","outline","line","origin","gcodePoints","points","raise","firstPoint","feedRate","jogHeight","jogRate","point","paths","passDepths","depthOfPasses","cutDepth","passDepth","paths2","p","i","x","plungeRate","units","preamble","gcode","text","join","pocket","drawing","geometry"],"mappings":"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","sourcesContent":["// makerjs model, depth, params -> pocket toolpath\nimport {clipOffsetContour} from '../unmakerjs/clipper.js'\n\n\nconst len = (toolpath) => Object.keys(toolpath).length;\n\nconst isToolpath = (toolpath) => {\n  // console.log(\"toolpath\", toolpath);\n\n  if (len(toolpath) >= 1) {\n    return true;\n  } else {\n    return false;\n  }\n}\n\nconst createToolpaths = (geo, params) => {\n  let contours = [];\n  let count = 0;\n\n  let pass = clipOffsetContour(geo, -params.compensatedRadius); //returns array of contours\n\n  if (isToolpath(pass) !== true) {\n    return contours;\n  }\n\n  while (isToolpath(pass)) {\n    contours.push(pass);\n    count++;\n    let lastPass = contours[count - 1];\n    // console.log(\"lastPass\", lastPass)\n    pass = lastPass.map(contour => clipOffsetContour(contour, -params.compensatedRadius * params.stepoverPercentage/100)).flat();\n\n  }\n\n  return contours.flat();\n}\n\nexport const pocketGcode = (toolpaths, params) => {\n  let keyPoints = toolpaths.map(outline => outline.map(line => [line.origin[0], line.origin[1]]));\n\n  // toolpaths = Object.values(toolpaths).flat(2);\n  // console.log(\"toolpaths\", toolpaths);\n\n  // console.log(\"keyPoints\", keyPoints);\n\n  let gcodePoints = keyPoints.map(points => {\n    let raise = points.length > 1;\n    let firstPoint = points[0];\n\n    firstPoint = `G1 X${firstPoint[0]} Y${firstPoint[1]} F${params.feedRate}`;\n\n    if (raise) {\n      return [\n        `G1 Z${params.jogHeight} F${params.jogRate}`,\n        firstPoint, //want to jog to this one\n        \"plunge\",\n        ...points.map(point => `G1 X${point[0]} Y${point[1]} F${params.feedRate}`),\n        firstPoint,\n        `G1 Z${params.jogHeight} F${params.jogRate}`,\n      ]\n    } else {\n      return [\n        firstPoint,\n        \"plunge\",\n        ...points.map(point => `G1 X${point[0]} Y${point[1]} F${params.feedRate}`),\n        firstPoint\n      ]\n    }\n  });\n\n  let paths = gcodePoints.flat();\n\n  // let firstPoint = keyPoints[0][0][0];\n\n  let passDepths = params.depthOfPasses(params.cutDepth, params.passDepth);\n  \n  let paths2 = params.depthOfPasses(params.cutDepth, params.passDepth).map((p,i) => [\n    ...paths.map(x => (x === \"plunge\") ? `G1 Z${params.depthOfPasses[i]} F${params.plungeRate}` : x), //plunge rate\n  ])\n\n  // console.log(paths2)\n\n  paths2 = paths2.flat();\n\n  let units;\n  if (params.units === \"in\") units = \"G20\";\n  if (params.units === \"mm\") units = \"G21\";\n\n  let preamble = [units, \"G90\"];\n\n  let gcode = [\n    ...preamble,\n    \"(end of preamble)\",\n    `G1 Z${params.jogHeight} F${params.jogRate}`,\n    // `G0 X${firstPoint[0]} Y${firstPoint[1]}`,\n    ...paths2,\n    `G1 Z${params.jogHeight} F${params.jogRate}`,\n  ]\n\n\n  let text = gcode.join('\\n');\n\n  return text;\n}\n\nexport const pocket = (contour, params) => {\n\n  let toolpaths = createToolpaths(contour, params);\n  //let gcode = pocketGcode(toolpaths, params)\n\n  return {drawing: toolpaths, geometry: toolpaths};\n};\n"]},"metadata":{},"sourceType":"module"}