"use strict";

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

var _objectSpread2 = _interopRequireDefault(require("@babel/runtime/helpers/objectSpread"));

var _objectWithoutProperties2 = _interopRequireDefault(require("@babel/runtime/helpers/objectWithoutProperties"));

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _possibleConstructorReturn2 = _interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));

var _getPrototypeOf3 = _interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));

var _assertThisInitialized2 = _interopRequireDefault(require("@babel/runtime/helpers/assertThisInitialized"));

var _inherits2 = _interopRequireDefault(require("@babel/runtime/helpers/inherits"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _react = _interopRequireWildcard(require("react"));

var _propTypes = _interopRequireDefault(require("prop-types"));

var _fuzzaldrinPlus = _interopRequireDefault(require("fuzzaldrin-plus"));

var _downshift = _interopRequireDefault(require("downshift"));

var _reactTinyVirtualList = _interopRequireDefault(require("react-tiny-virtual-list"));

var _popover = require("../../popover");

var _constants = require("../../constants");

var _typography = require("../../typography");

var _layers = require("../../layers");

var _AutocompleteItem = _interopRequireDefault(require("./AutocompleteItem"));

var fuzzyFilter = function fuzzyFilter(itemToString) {
  if (itemToString) {
    return function (items, input) {
      var wrappedItems = items.map(function (item) {
        return {
          key: itemToString(item),
          item: item
        };
      });
      return _fuzzaldrinPlus.default.filter(wrappedItems, input, {
        key: 'key'
      }).map(function (_ref) {
        var item = _ref.item;
        return item;
      });
    };
  }

  return function (items, input) {
    return _fuzzaldrinPlus.default.filter(items, input);
  };
};

var autocompleteItemRenderer = function autocompleteItemRenderer(props) {
  return _react.default.createElement(_AutocompleteItem.default, props);
};

autocompleteItemRenderer.displayName = "autocompleteItemRenderer";

// https://github.com/paypal/downshift/issues/164
var Autocomplete =
/*#__PURE__*/
function (_PureComponent) {
  (0, _inherits2.default)(Autocomplete, _PureComponent);

  function Autocomplete() {
    var _getPrototypeOf2;

    var _this;

    (0, _classCallCheck2.default)(this, Autocomplete);

    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {
      args[_key] = arguments[_key];
    }

    _this = (0, _possibleConstructorReturn2.default)(this, (_getPrototypeOf2 = (0, _getPrototypeOf3.default)(Autocomplete)).call.apply(_getPrototypeOf2, [this].concat(args)));
    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)(_this), "state", {
      targetWidth: 0
    });
    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)(_this), "renderResults", function (_ref2) {
      var width = _ref2.width,
          inputValue = _ref2.inputValue,
          highlightedIndex = _ref2.highlightedIndex,
          selectItemAtIndex = _ref2.selectItemAtIndex,
          selectedItem = _ref2.selectedItem,
          getItemProps = _ref2.getItemProps;
      var _this$props = _this.props,
          title = _this$props.title,
          itemSize = _this$props.itemSize,
          itemsFilter = _this$props.itemsFilter,
          originalItems = _this$props.items,
          itemToString = _this$props.itemToString,
          _renderItem = _this$props.renderItem,
          popoverMaxHeight = _this$props.popoverMaxHeight,
          isFilterDisabled = _this$props.isFilterDisabled;
      var filter = itemsFilter || fuzzyFilter(itemToString);
      var items = isFilterDisabled || inputValue.trim() === '' ? originalItems : filter(originalItems, inputValue);
      if (items.length === 0) return null;
      return _react.default.createElement(_layers.Pane, {
        width: width
      }, title && _react.default.createElement(_layers.Pane, {
        padding: 8,
        borderBottom: "muted"
      }, _react.default.createElement(_typography.Heading, {
        size: 100
      }, title)), items.length > 0 && _react.default.createElement(_reactTinyVirtualList.default, {
        width: "100%",
        height: Math.min(items.length * itemSize, popoverMaxHeight),
        itemSize: itemSize,
        itemCount: items.length,
        scrollToIndex: highlightedIndex || 0,
        overscanCount: 3,
        scrollToAlignment: "auto",
        renderItem: function renderItem(_ref3) {
          var index = _ref3.index,
              style = _ref3.style;
          var item = items[index];
          var itemString = itemToString(item);
          return _renderItem(getItemProps({
            item: item,
            key: itemString,
            index: index,
            style: style,
            children: itemString,
            onMouseUp: function onMouseUp() {
              selectItemAtIndex(index);
            },
            isSelected: itemToString(selectedItem) === itemString,
            isHighlighted: highlightedIndex === index
          }));
        }
      }));
    });
    return _this;
  }

  (0, _createClass2.default)(Autocomplete, [{
    key: "componentDidMount",
    value: function componentDidMount() {
      this.setState({
        targetWidth: this.targetRef.getBoundingClientRect().width
      });
    }
  }, {
    key: "render",
    value: function render() {
      var _this2 = this;

      var _this$props2 = this.props,
          children = _this$props2.children,
          itemSize = _this$props2.itemSize,
          position = _this$props2.position,
          renderItem = _this$props2.renderItem,
          itemsFilter = _this$props2.itemsFilter,
          popoverMaxHeight = _this$props2.popoverMaxHeight,
          popoverMinWidth = _this$props2.popoverMinWidth,
          defaultSelectedItem = _this$props2.defaultSelectedItem,
          props = (0, _objectWithoutProperties2.default)(_this$props2, ["children", "itemSize", "position", "renderItem", "itemsFilter", "popoverMaxHeight", "popoverMinWidth", "defaultSelectedItem"]);
      return _react.default.createElement(_downshift.default, (0, _extends2.default)({
        defaultSelectedItem: defaultSelectedItem
      }, props), function (_ref4) {
        var isShown = _ref4.isOpen,
            inputValue = _ref4.inputValue,
            getItemProps = _ref4.getItemProps,
            selectedItem = _ref4.selectedItem,
            highlightedIndex = _ref4.highlightedIndex,
            selectItemAtIndex = _ref4.selectItemAtIndex,
            getRootProps = _ref4.getRootProps,
            restDownshiftProps = (0, _objectWithoutProperties2.default)(_ref4, ["isOpen", "inputValue", "getItemProps", "selectedItem", "highlightedIndex", "selectItemAtIndex", "getRootProps"]);
        return _react.default.createElement(_layers.Pane, (0, _extends2.default)({
          width: "100%"
        }, getRootProps({
          refKey: 'innerRef'
        })), _react.default.createElement(_popover.Popover, {
          bringFocusInside: false,
          isShown: isShown,
          minWidth: popoverMinWidth,
          position: position || (_this2.state.targetWidth < popoverMinWidth ? _constants.Position.BOTTOM_LEFT : _constants.Position.BOTTOM),
          content: function content() {
            return _this2.renderResults({
              width: Math.max(_this2.state.targetWidth, popoverMinWidth),
              inputValue: inputValue,
              getItemProps: getItemProps,
              selectedItem: selectedItem,
              highlightedIndex: highlightedIndex,
              selectItemAtIndex: selectItemAtIndex
            });
          },
          minHeight: 0,
          animationDuration: 0
        }, function (_ref5) {
          var isShownPopover = _ref5.isShown,
              toggle = _ref5.toggle,
              _getRef = _ref5.getRef;
          return children((0, _objectSpread2.default)({
            isShown: isShownPopover,
            toggle: toggle,
            getRef: function getRef(ref) {
              // Use the ref internally to determine the width
              _this2.targetRef = ref;

              _getRef(ref);
            },
            inputValue: inputValue,
            selectedItem: selectedItem,
            highlightedIndex: highlightedIndex,
            selectItemAtIndex: selectItemAtIndex
          }, restDownshiftProps));
        }));
      });
    }
  }]);
  return Autocomplete;
}(_react.PureComponent);

exports.default = Autocomplete;
Autocomplete.displayName = "Autocomplete";
(0, _defineProperty2.default)(Autocomplete, "propTypes", (0, _objectSpread2.default)({
  /**
   * This prop can be either a string or a Node.
   * It will provide a title for the items
   */
  title: _propTypes.default.oneOfType([_propTypes.default.string, _propTypes.default.node]),

  /**
   * An array of items to be used as options for the select
   */
  items: _propTypes.default.array.isRequired,

  /**
   * The selected Item to be shown on the autocomplete
   */
  selectedItem: _propTypes.default.any,

  /**
   * The selected item to be selected & shown by default on the autocomplete
   */
  defaultSelectedItem: _propTypes.default.any,

  /**
   * In case the array of items is not an array of strings,
   * this function is used on each item to return the string that will be shown on the filter
   */
  itemToString: _propTypes.default.func.isRequired,

  /**
   * Function that will render the 'filter' component.
   */
  children: _propTypes.default.func.isRequired,

  /**
   * The height of each item in the list
   * Because the list is virtualized this is required beforehand.
   */
  itemSize: _propTypes.default.number,

  /**
   * Function that returns a component to render the item
   */
  renderItem: _propTypes.default.func,

  /**
   * The position of the Popover the Autocomplete is rendered in.
   */
  position: _propTypes.default.oneOf(Object.keys(_constants.Position)),

  /**
   * A function that is used to filter the items.
   * It should return a subset of the initial items.
   * By default the "fuzzaldrin-plus" package is used.
   */
  itemsFilter: _propTypes.default.func,

  /**
   * Prop that enables and disables filtering
   * True: Enables Filtering
   * False: Disables Filtering
   */
  isFilterDisabled: _propTypes.default.bool,

  /**
   * Defines the minimum height the results container will be
   */
  popoverMinWidth: _propTypes.default.number,

  /**
   * Defines the maximum height the results container will be
   */
  popoverMaxHeight: _propTypes.default.number
}, _downshift.default.propTypes));
(0, _defineProperty2.default)(Autocomplete, "defaultProps", {
  itemToString: function itemToString(i) {
    return i ? String(i) : '';
  },
  itemSize: 32,
  isFilterDisabled: false,
  popoverMinWidth: 240,
  popoverMaxHeight: 240,
  renderItem: autocompleteItemRenderer
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9hdXRvY29tcGxldGUvc3JjL0F1dG9jb21wbGV0ZS5qcyJdLCJuYW1lcyI6WyJmdXp6eUZpbHRlciIsIml0ZW1Ub1N0cmluZyIsIml0ZW1zIiwiaW5wdXQiLCJ3cmFwcGVkSXRlbXMiLCJtYXAiLCJpdGVtIiwia2V5IiwiZnV6emFsZHJpbiIsImZpbHRlciIsImF1dG9jb21wbGV0ZUl0ZW1SZW5kZXJlciIsInByb3BzIiwiQXV0b2NvbXBsZXRlIiwidGFyZ2V0V2lkdGgiLCJ3aWR0aCIsImlucHV0VmFsdWUiLCJoaWdobGlnaHRlZEluZGV4Iiwic2VsZWN0SXRlbUF0SW5kZXgiLCJzZWxlY3RlZEl0ZW0iLCJnZXRJdGVtUHJvcHMiLCJ0aXRsZSIsIml0ZW1TaXplIiwiaXRlbXNGaWx0ZXIiLCJvcmlnaW5hbEl0ZW1zIiwicmVuZGVySXRlbSIsInBvcG92ZXJNYXhIZWlnaHQiLCJpc0ZpbHRlckRpc2FibGVkIiwidHJpbSIsImxlbmd0aCIsIk1hdGgiLCJtaW4iLCJpbmRleCIsInN0eWxlIiwiaXRlbVN0cmluZyIsImNoaWxkcmVuIiwib25Nb3VzZVVwIiwiaXNTZWxlY3RlZCIsImlzSGlnaGxpZ2h0ZWQiLCJzZXRTdGF0ZSIsInRhcmdldFJlZiIsImdldEJvdW5kaW5nQ2xpZW50UmVjdCIsInBvc2l0aW9uIiwicG9wb3Zlck1pbldpZHRoIiwiZGVmYXVsdFNlbGVjdGVkSXRlbSIsImlzU2hvd24iLCJpc09wZW4iLCJnZXRSb290UHJvcHMiLCJyZXN0RG93bnNoaWZ0UHJvcHMiLCJyZWZLZXkiLCJzdGF0ZSIsIlBvc2l0aW9uIiwiQk9UVE9NX0xFRlQiLCJCT1RUT00iLCJyZW5kZXJSZXN1bHRzIiwibWF4IiwiaXNTaG93blBvcG92ZXIiLCJ0b2dnbGUiLCJnZXRSZWYiLCJyZWYiLCJQdXJlQ29tcG9uZW50IiwiUHJvcFR5cGVzIiwib25lT2ZUeXBlIiwic3RyaW5nIiwibm9kZSIsImFycmF5IiwiaXNSZXF1aXJlZCIsImFueSIsImZ1bmMiLCJudW1iZXIiLCJvbmVPZiIsIk9iamVjdCIsImtleXMiLCJib29sIiwiRG93bnNoaWZ0IiwicHJvcFR5cGVzIiwiaSIsIlN0cmluZyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUVBLElBQU1BLFdBQVcsR0FBRyxTQUFkQSxXQUFjLENBQUFDLFlBQVksRUFBSTtBQUNsQyxNQUFJQSxZQUFKLEVBQWtCO0FBQ2hCLFdBQU8sVUFBQ0MsS0FBRCxFQUFRQyxLQUFSLEVBQWtCO0FBQ3ZCLFVBQU1DLFlBQVksR0FBR0YsS0FBSyxDQUFDRyxHQUFOLENBQVUsVUFBQUMsSUFBSTtBQUFBLGVBQUs7QUFDdENDLFVBQUFBLEdBQUcsRUFBRU4sWUFBWSxDQUFDSyxJQUFELENBRHFCO0FBRXRDQSxVQUFBQSxJQUFJLEVBQUpBO0FBRnNDLFNBQUw7QUFBQSxPQUFkLENBQXJCO0FBS0EsYUFBT0Usd0JBQ0pDLE1BREksQ0FDR0wsWUFESCxFQUNpQkQsS0FEakIsRUFDd0I7QUFBRUksUUFBQUEsR0FBRyxFQUFFO0FBQVAsT0FEeEIsRUFFSkYsR0FGSSxDQUVBO0FBQUEsWUFBR0MsSUFBSCxRQUFHQSxJQUFIO0FBQUEsZUFBY0EsSUFBZDtBQUFBLE9BRkEsQ0FBUDtBQUdELEtBVEQ7QUFVRDs7QUFFRCxTQUFPLFVBQUNKLEtBQUQsRUFBUUMsS0FBUjtBQUFBLFdBQWtCSyx3QkFBV0MsTUFBWCxDQUFrQlAsS0FBbEIsRUFBeUJDLEtBQXpCLENBQWxCO0FBQUEsR0FBUDtBQUNELENBZkQ7O0FBaUJBLElBQU1PLHdCQUF3QixHQUFHLFNBQTNCQSx3QkFBMkIsQ0FBQUMsS0FBSztBQUFBLFNBQUksNkJBQUMseUJBQUQsRUFBc0JBLEtBQXRCLENBQUo7QUFBQSxDQUF0Qzs7QUFBTUQsd0I7O0FBRU47SUFDcUJFLFk7Ozs7Ozs7Ozs7Ozs7Ozs7O3dGQTZFWDtBQUNOQyxNQUFB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RUFBQUEsUUFBUSxFQUFFLEVBRlU7QUFHcEJLLEVBQUFBLGdCQUFnQixFQUFFLEtBSEU7QUFJcEJnQixFQUFBQSxlQUFlLEVBQUUsR0FKRztBQUtwQmpCLEVBQUFBLGdCQUFnQixFQUFFLEdBTEU7QUFNcEJELEVBQUFBLFVBQVUsRUFBRWQ7QUFOUSxDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFJlYWN0LCB7IFB1cmVDb21wb25lbnQgfSBmcm9tICdyZWFjdCdcbmltcG9ydCBQcm9wVHlwZXMgZnJvbSAncHJvcC10eXBlcydcbmltcG9ydCBmdXp6YWxkcmluIGZyb20gJ2Z1enphbGRyaW4tcGx1cydcbmltcG9ydCBEb3duc2hpZnQgZnJvbSAnZG93bnNoaWZ0J1xuaW1wb3J0IFZpcnR1YWxMaXN0IGZyb20gJ3JlYWN0LXRpbnktdmlydHVhbC1saXN0J1xuaW1wb3J0IHsgUG9wb3ZlciB9IGZyb20gJy4uLy4uL3BvcG92ZXInXG5pbXBvcnQgeyBQb3NpdGlvbiB9IGZyb20gJy4uLy4uL2NvbnN0YW50cydcbmltcG9ydCB7IEhlYWRpbmcgfSBmcm9tICcuLi8uLi90eXBvZ3JhcGh5J1xuaW1wb3J0IHsgUGFuZSB9IGZyb20gJy4uLy4uL2xheWVycydcbmltcG9ydCBBdXRvY29tcGxldGVJdGVtIGZyb20gJy4vQXV0b2NvbXBsZXRlSXRlbSdcblxuY29uc3QgZnV6enlGaWx0ZXIgPSBpdGVtVG9TdHJpbmcgPT4ge1xuICBpZiAoaXRlbVRvU3RyaW5nKSB7XG4gICAgcmV0dXJuIChpdGVtcywgaW5wdXQpID0+IHtcbiAgICAgIGNvbnN0IHdyYXBwZWRJdGVtcyA9IGl0ZW1zLm1hcChpdGVtID0+ICh7XG4gICAgICAgIGtleTogaXRlbVRvU3RyaW5nKGl0ZW0pLFxuICAgICAgICBpdGVtXG4gICAgICB9KSlcblxuICAgICAgcmV0dXJuIGZ1enphbGRyaW5cbiAgICAgICAgLmZpbHRlcih3cmFwcGVkSXRlbXMsIGlucHV0LCB7IGtleTogJ2tleScgfSlcbiAgICAgICAgLm1hcCgoeyBpdGVtIH0pID0+IGl0ZW0pXG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIChpdGVtcywgaW5wdXQpID0+IGZ1enphbGRyaW4uZmlsdGVyKGl0ZW1zLCBpbnB1dClcbn1cblxuY29uc3QgYXV0b2NvbXBsZXRlSXRlbVJlbmRlcmVyID0gcHJvcHMgPT4gPEF1dG9jb21wbGV0ZUl0ZW0gey4uLnByb3BzfSAvPlxuXG4vLyBodHRwczovL2dpdGh1Yi5jb20vcGF5cGFsL2Rvd25zaGlmdC9pc3N1ZXMvMTY0XG5leHBvcnQgZGVmYXVsdCBjbGFzcyBBdXRvY29tcGxldGUgZXh0ZW5kcyBQdXJlQ29tcG9uZW50IHtcbiAgc3RhdGljIHByb3BUeXBlcyA9IHtcbiAgICAvKipcbiAgICAgKiBUaGlzIHByb3AgY2FuIGJlIGVpdGhlciBhIHN0cmluZyBvciBhIE5vZGUuXG4gICAgICogSXQgd2lsbCBwcm92aWRlIGEgdGl0bGUgZm9yIHRoZSBpdGVtc1xuICAgICAqL1xuICAgIHRpdGxlOiBQcm9wVHlwZXMub25lT2ZUeXBlKFtQcm9wVHlwZXMuc3RyaW5nLCBQcm9wVHlwZXMubm9kZV0pLFxuXG4gICAgLyoqXG4gICAgICogQW4gYXJyYXkgb2YgaXRlbXMgdG8gYmUgdXNlZCBhcyBvcHRpb25zIGZvciB0aGUgc2VsZWN0XG4gICAgICovXG4gICAgaXRlbXM6IFByb3BUeXBlcy5hcnJheS5pc1JlcXVpcmVkLFxuXG4gICAgLyoqXG4gICAgICogVGhlIHNlbGVjdGVkIEl0ZW0gdG8gYmUgc2hvd24gb24gdGhlIGF1dG9jb21wbGV0ZVxuICAgICAqL1xuICAgIHNlbGVjdGVkSXRlbTogUHJvcFR5cGVzLmFueSxcblxuICAgIC8qKlxuICAgICAqIFRoZSBzZWxlY3RlZCBpdGVtIHRvIGJlIHNlbGVjdGVkICYgc2hvd24gYnkgZGVmYXVsdCBvbiB0aGUgYXV0b2NvbXBsZXRlXG4gICAgICovXG4gICAgZGVmYXVsdFNlbGVjdGVkSXRlbTogUHJvcFR5cGVzLmFueSxcblxuICAgIC8qKlxuICAgICAqIEluIGNhc2UgdGhlIGFycmF5IG9mIGl0ZW1zIGlzIG5vdCBhbiBhcnJheSBvZiBzdHJpbmdzLFxuICAgICAqIHRoaXMgZnVuY3Rpb24gaXMgdXNlZCBvbiBlYWNoIGl0ZW0gdG8gcmV0dXJuIHRoZSBzdHJpbmcgdGhhdCB3aWxsIGJlIHNob3duIG9uIHRoZSBmaWx0ZXJcbiAgICAgKi9cbiAgICBpdGVtVG9TdHJpbmc6IFByb3BUeXBlcy5mdW5jLmlzUmVxdWlyZWQsXG5cbiAgICAvKipcbiAgICAgKiBGdW5jdGlvbiB0aGF0IHdpbGwgcmVuZGVyIHRoZSAnZmlsdGVyJyBjb21wb25lbnQuXG4gICAgICovXG4gICAgY2hpbGRyZW46IFByb3BUeXBlcy5mdW5jLmlzUmVxdWlyZWQsXG5cbiAgICAvKipcbiAgICAgKiBUaGUgaGVpZ2h0IG9mIGVhY2ggaXRlbSBpbiB0aGUgbGlzdFxuICAgICAqIEJlY2F1c2UgdGhlIGxpc3QgaXMgdmlydHVhbGl6ZWQgdGhpcyBpcyByZXF1aXJlZCBiZWZvcmVoYW5kLlxuICAgICAqL1xuICAgIGl0ZW1TaXplOiBQcm9wVHlwZXMubnVtYmVyLFxuXG4gICAgLyoqXG4gICAgICogRnVuY3Rpb24gdGhhdCByZXR1cm5zIGEgY29tcG9uZW50IHRvIHJlbmRlciB0aGUgaXRlbVxuICAgICAqL1xuICAgIHJlbmRlckl0ZW06IFByb3BUeXBlcy5mdW5jLFxuXG4gICAgLyoqXG4gICAgICogVGhlIHBvc2l0aW9uIG9mIHRoZSBQb3BvdmVyIHRoZSBBdXRvY29tcGxldGUgaXMgcmVuZGVyZWQgaW4uXG4gICAgICovXG4gICAgcG9zaXRpb246IFByb3BUeXBlcy5vbmVPZihPYmplY3Qua2V5cyhQb3NpdGlvbikpLFxuXG4gICAgLyoqXG4gICAgICogQSBmdW5jdGlvbiB0aGF0IGlzIHVzZWQgdG8gZmlsdGVyIHRoZSBpdGVtcy5cbiAgICAgKiBJdCBzaG91bGQgcmV0dXJuIGEgc3Vic2V0IG9mIHRoZSBpbml0aWFsIGl0ZW1zLlxuICAgICAqIEJ5IGRlZmF1bHQgdGhlIFwiZnV6emFsZHJpbi1wbHVzXCIgcGFja2FnZSBpcyB1c2VkLlxuICAgICAqL1xuICAgIGl0ZW1zRmlsdGVyOiBQcm9wVHlwZXMuZnVuYyxcblxuICAgIC8qKlxuICAgICAqIFByb3AgdGhhdCBlbmFibGVzIGFuZCBkaXNhYmxlcyBmaWx0ZXJpbmdcbiAgICAgKiBUcnVlOiBFbmFibGVzIEZpbHRlcmluZ1xuICAgICAqIEZhbHNlOiBEaXNhYmxlcyBGaWx0ZXJpbmdcbiAgICAgKi9cbiAgICBpc0ZpbHRlckRpc2FibGVkOiBQcm9wVHlwZXMuYm9vbCxcblxuICAgIC8qKlxuICAgICAqIERlZmluZXMgdGhlIG1pbmltdW0gaGVpZ2h0IHRoZSByZXN1bHRzIGNvbnRhaW5lciB3aWxsIGJlXG4gICAgICovXG4gICAgcG9wb3Zlck1pbldpZHRoOiBQcm9wVHlwZXMubnVtYmVyLFxuXG4gICAgLyoqXG4gICAgICogRGVmaW5lcyB0aGUgbWF4aW11bSBoZWlnaHQgdGhlIHJlc3VsdHMgY29udGFpbmVyIHdpbGwgYmVcbiAgICAgKi9cbiAgICBwb3BvdmVyTWF4SGVpZ2h0OiBQcm9wVHlwZXMubnVtYmVyLFxuXG4gICAgLi4uRG93bnNoaWZ0LnByb3BUeXBlc1xuICB9XG5cbiAgc3RhdGUgPSB7XG4gICAgdGFyZ2V0V2lkdGg6IDBcbiAgfVxuXG4gIHN0YXRpYyBkZWZhdWx0UHJvcHMgPSB7XG4gICAgaXRlbVRvU3RyaW5nOiBpID0+IChpID8gU3RyaW5nKGkpIDogJycpLFxuICAgIGl0ZW1TaXplOiAzMixcbiAgICBpc0ZpbHRlckRpc2FibGVkOiBmYWxzZSxcbiAgICBwb3BvdmVyTWluV2lkdGg6IDI0MCxcbiAgICBwb3BvdmVyTWF4SGVpZ2h0OiAyNDAsXG4gICAgcmVuZGVySXRlbTogYXV0b2NvbXBsZXRlSXRlbVJlbmRlcmVyXG4gIH1cblxuICBjb21wb25lbnREaWRNb3VudCgpIHtcbiAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgIHRhcmdldFdpZHRoOiB0aGlzLnRhcmdldFJlZi5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS53aWR0aFxuICAgIH0pXG4gIH1cblxuICByZW5kZXJSZXN1bHRzID0gKHtcbiAgICB3aWR0aCxcbiAgICBpbnB1dFZhbHVlLFxuICAgIGhpZ2hsaWdodGVkSW5kZXgsXG4gICAgc2VsZWN0SXRlbUF0SW5kZXgsXG4gICAgc2VsZWN0ZWRJdGVtLFxuICAgIGdldEl0ZW1Qcm9wc1xuICB9KSA9PiB7XG4gICAgY29uc3Qge1xuICAgICAgdGl0bGUsXG4gICAgICBpdGVtU2l6ZSxcbiAgICAgIGl0ZW1zRmlsdGVyLFxuICAgICAgaXRlbXM6IG9yaWdpbmFsSXRlbXMsXG4gICAgICBpdGVtVG9TdHJpbmcsXG4gICAgICByZW5kZXJJdGVtLFxuICAgICAgcG9wb3Zlck1heEhlaWdodCxcbiAgICAgIGlzRmlsdGVyRGlzYWJsZWRcbiAgICB9ID0gdGhpcy5wcm9wc1xuXG4gICAgY29uc3QgZmlsdGVyID0gaXRlbXNGaWx0ZXIgfHwgZnV6enlGaWx0ZXIoaXRlbVRvU3RyaW5nKVxuICAgIGNvbnN0IGl0ZW1zID1cbiAgICAgIGlzRmlsdGVyRGlzYWJsZWQgfHwgaW5wdXRWYWx1ZS50cmltKCkgPT09ICcnXG4gICAgICAgID8gb3JpZ2luYWxJdGVtc1xuICAgICAgICA6IGZpbHRlcihvcmlnaW5hbEl0ZW1zLCBpbnB1dFZhbHVlKVxuXG4gICAgaWYgKGl0ZW1zLmxlbmd0aCA9PT0gMCkgcmV0dXJuIG51bGxcblxuICAgIHJldHVybiAoXG4gICAgICA8UGFuZSB3aWR0aD17d2lkdGh9PlxuICAgICAgICB7dGl0bGUgJiYgKFxuICAgICAgICAgIDxQYW5lIHBhZGRpbmc9ezh9IGJvcmRlckJvdHRvbT1cIm11dGVkXCI+XG4gICAgICAgICAgICA8SGVhZGluZyBzaXplPXsxMDB9Pnt0aXRsZX08L0hlYWRpbmc+XG4gICAgICAgICAgPC9QYW5lPlxuICAgICAgICApfVxuICAgICAgICB7aXRlbXMubGVuZ3RoID4gMCAmJiAoXG4gICAgICAgICAgPFZpcnR1YWxMaXN0XG4gICAgICAgICAgICB3aWR0aD1cIjEwMCVcIlxuICAgICAgICAgICAgaGVpZ2h0PXtNYXRoLm1pbihpdGVtcy5sZW5ndGggKiBpdGVtU2l6ZSwgcG9wb3Zlck1heEhlaWdodCl9XG4gICAgICAgICAgICBpdGVtU2l6ZT17aXRlbVNpemV9XG4gICAgICAgICAgICBpdGVtQ291bnQ9e2l0ZW1zLmxlbmd0aH1cbiAgICAgICAgICAgIHNjcm9sbFRvSW5kZXg9e2hpZ2hsaWdodGVkSW5kZXggfHwgMH1cbiAgICAgICAgICAgIG92ZXJzY2FuQ291bnQ9ezN9XG4gICAgICAgICAgICBzY3JvbGxUb0FsaWdubWVudD1cImF1dG9cIlxuICAgICAgICAgICAgcmVuZGVySXRlbT17KHsgaW5kZXgsIHN0eWxlIH0pID0+IHtcbiAgICAgICAgICAgICAgY29uc3QgaXRlbSA9IGl0ZW1zW2luZGV4XVxuICAgICAgICAgICAgICBjb25zdCBpdGVtU3RyaW5nID0gaXRlbVRvU3RyaW5nKGl0ZW0pXG4gICAgICAgICAgICAgIHJldHVybiByZW5kZXJJdGVtKFxuICAgICAgICAgICAgICAgIGdldEl0ZW1Qcm9wcyh7XG4gICAgICAgICAgICAgICAgICBpdGVtLFxuICAgICAgICAgICAgICAgICAga2V5OiBpdGVtU3RyaW5nLFxuICAgICAgICAgICAgICAgICAgaW5kZXgsXG4gICAgICAgICAgICAgICAgICBzdHlsZSxcbiAgICAgICAgICAgICAgICAgIGNoaWxkcmVuOiBpdGVtU3RyaW5nLFxuICAgICAgICAgICAgICAgICAgb25Nb3VzZVVwOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHNlbGVjdEl0ZW1BdEluZGV4KGluZGV4KVxuICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgIGlzU2VsZWN0ZWQ6IGl0ZW1Ub1N0cmluZyhzZWxlY3RlZEl0ZW0pID09PSBpdGVtU3RyaW5nLFxuICAgICAgICAgICAgICAgICAgaXNIaWdobGlnaHRlZDogaGlnaGxpZ2h0ZWRJbmRleCA9PT0gaW5kZXhcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICApXG4gICAgICAgICAgICB9fVxuICAgICAgICAgIC8+XG4gICAgICAgICl9XG4gICAgICA8L1BhbmU+XG4gICAgKVxuICB9XG5cbiAgcmVuZGVyKCkge1xuICAgIGNvbnN0IHtcbiAgICAgIGNoaWxkcmVuLFxuICAgICAgaXRlbVNpemUsXG4gICAgICBwb3NpdGlvbixcbiAgICAgIHJlbmRlckl0ZW0sXG4gICAgICBpdGVtc0ZpbHRlcixcbiAgICAgIHBvcG92ZXJNYXhIZWlnaHQsXG4gICAgICBwb3BvdmVyTWluV2lkdGgsXG4gICAgICBkZWZhdWx0U2VsZWN0ZWRJdGVtLFxuICAgICAgLi4ucHJvcHNcbiAgICB9ID0gdGhpcy5wcm9wc1xuXG4gICAgcmV0dXJuIChcbiAgICAgIDxEb3duc2hpZnQgZGVmYXVsdFNlbGVjdGVkSXRlbT17ZGVmYXVsdFNlbGVjdGVkSXRlbX0gey4uLnByb3BzfT5cbiAgICAgICAgeyh7XG4gICAgICAgICAgaXNPcGVuOiBpc1Nob3duLFxuICAgICAgICAgIGlucHV0VmFsdWUsXG4gICAgICAgICAgZ2V0SXRlbVByb3BzLFxuICAgICAgICAgIHNlbGVjdGVkSXRlbSxcbiAgICAgICAgICBoaWdobGlnaHRlZEluZGV4LFxuICAgICAgICAgIHNlbGVjdEl0ZW1BdEluZGV4LFxuICAgICAgICAgIGdldFJvb3RQcm9wcyxcbiAgICAgICAgICAuLi5yZXN0RG93bnNoaWZ0UHJvcHNcbiAgICAgICAgfSkgPT4gKFxuICAgICAgICAgIDxQYW5lIHdpZHRoPVwiMTAwJVwiIHsuLi5nZXRSb290UHJvcHMoeyByZWZLZXk6ICdpbm5lclJlZicgfSl9PlxuICAgICAgICAgICAgPFBvcG92ZXJcbiAgICAgICAgICAgICAgYnJpbmdGb2N1c0luc2lkZT17ZmFsc2V9XG4gICAgICAgICAgICAgIGlzU2hvd249e2lzU2hvd259XG4gICAgICAgICAgICAgIG1pbldpZHRoPXtwb3BvdmVyTWluV2lkdGh9XG4gICAgICAgICAgICAgIHBvc2l0aW9uPXtcbiAgICAgICAgICAgICAgICBwb3NpdGlvbiB8fFxuICAgICAgICAgICAgICAgICh0aGlzLnN0YXRlLnRhcmdldFdpZHRoIDwgcG9wb3Zlck1pbldpZHRoXG4gICAgICAgICAgICAgICAgICA/IFBvc2l0aW9uLkJPVFRPTV9MRUZUXG4gICAgICAgICAgICAgICAgICA6IFBvc2l0aW9uLkJPVFRPTSlcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBjb250ZW50PXsoKSA9PiB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucmVuZGVyUmVzdWx0cyh7XG4gICAgICAgICAgICAgICAgICB3aWR0aDogTWF0aC5tYXgodGhpcy5zdGF0ZS50YXJnZXRXaWR0aCwgcG9wb3Zlck1pbldpZHRoKSxcbiAgICAgICAgICAgICAgICAgIGlucHV0VmFsdWUsXG4gICAgICAgICAgICAgICAgICBnZXRJdGVtUHJvcHMsXG4gICAgICAgICAgICAgICAgICBzZWxlY3RlZEl0ZW0sXG4gICAgICAgICAgICAgICAgICBoaWdobGlnaHRlZEluZGV4LFxuICAgICAgICAgICAgICAgICAgc2VsZWN0SXRlbUF0SW5kZXhcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICB9fVxuICAgICAgICAgICAgICBtaW5IZWlnaHQ9ezB9XG4gICAgICAgICAgICAgIGFuaW1hdGlvbkR1cmF0aW9uPXswfVxuICAgICAgICAgICAgPlxuICAgICAgICAgICAgICB7KHsgaXNTaG93bjogaXNTaG93blBvcG92ZXIsIHRvZ2dsZSwgZ2V0UmVmIH0pID0+XG4gICAgICAgICAgICAgICAgY2hpbGRyZW4oe1xuICAgICAgICAgICAgICAgICAgaXNTaG93bjogaXNTaG93blBvcG92ZXIsXG4gICAgICAgICAgICAgICAgICB0b2dnbGUsXG4gICAgICAgICAgICAgICAgICBnZXRSZWY6IHJlZiA9PiB7XG4gICAgICAgICAgICAgICAgICAgIC8vIFVzZSB0aGUgcmVmIGludGVybmFsbHkgdG8gZGV0ZXJtaW5lIHRoZSB3aWR0aFxuICAgICAgICAgICAgICAgICAgICB0aGlzLnRhcmdldFJlZiA9IHJlZlxuICAgICAgICAgICAgICAgICAgICBnZXRSZWYocmVmKVxuICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgIGlucHV0VmFsdWUsXG4gICAgICAgICAgICAgICAgICBzZWxlY3RlZEl0ZW0sXG4gICAgICAgICAgICAgICAgICBoaWdobGlnaHRlZEluZGV4LFxuICAgICAgICAgICAgICAgICAgc2VsZWN0SXRlbUF0SW5kZXgsXG4gICAgICAgICAgICAgICAgICAuLi5yZXN0RG93bnNoaWZ0UHJvcHNcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICA8L1BvcG92ZXI+XG4gICAgICAgICAgPC9QYW5lPlxuICAgICAgICApfVxuICAgICAgPC9Eb3duc2hpZnQ+XG4gICAgKVxuICB9XG59XG4iXX0=