"use strict";

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

var _objectSpread2 = _interopRequireDefault(require("@babel/runtime/helpers/objectSpread"));

var _objectWithoutProperties2 = _interopRequireDefault(require("@babel/runtime/helpers/objectWithoutProperties"));

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _possibleConstructorReturn2 = _interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));

var _getPrototypeOf2 = _interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));

var _assertThisInitialized2 = _interopRequireDefault(require("@babel/runtime/helpers/assertThisInitialized"));

var _inherits2 = _interopRequireDefault(require("@babel/runtime/helpers/inherits"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _react = _interopRequireWildcard(require("react"));

var _propTypes = _interopRequireDefault(require("prop-types"));

var _uiBox = _interopRequireWildcard(require("ui-box"));

var _autocomplete = require("../../autocomplete");

var _textInput = require("../../text-input");

var _buttons = require("../../buttons");

var Combobox =
/*#__PURE__*/
function (_PureComponent) {
  (0, _inherits2.default)(Combobox, _PureComponent);

  function Combobox(props, context) {
    var _this;

    (0, _classCallCheck2.default)(this, Combobox);
    _this = (0, _possibleConstructorReturn2.default)(this, (0, _getPrototypeOf2.default)(Combobox).call(this, props, context));
    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)(_this), "handleStateChange", function (changes) {
      if (Object.prototype.hasOwnProperty.call(changes, 'isOpen')) {
        if (!changes.isOpen) {
          _this.setState({
            isOpenedByButton: false
          });
        }
      }
    });
    _this.state = {
      isOpenedByButton: false
    };
    return _this;
  }

  (0, _createClass2.default)(Combobox, [{
    key: "render",
    value: function render() {
      var _this2 = this;

      var _this$props = this.props,
          items = _this$props.items,
          selectedItem = _this$props.selectedItem,
          defaultSelectedItem = _this$props.defaultSelectedItem,
          itemToString = _this$props.itemToString,
          width = _this$props.width,
          height = _this$props.height,
          onChange = _this$props.onChange,
          placeholder = _this$props.placeholder,
          inputProps = _this$props.inputProps,
          buttonProps = _this$props.buttonProps,
          openOnFocus = _this$props.openOnFocus,
          autocompleteProps = _this$props.autocompleteProps,
          isLoading = _this$props.isLoading,
          props = (0, _objectWithoutProperties2.default)(_this$props, ["items", "selectedItem", "defaultSelectedItem", "itemToString", "width", "height", "onChange", "placeholder", "inputProps", "buttonProps", "openOnFocus", "autocompleteProps", "isLoading"]);
      var disabled = props.disabled || isLoading;
      return _react.default.createElement(_autocomplete.Autocomplete, (0, _extends2.default)({
        items: items,
        selectedItem: selectedItem,
        defaultSelectedItem: defaultSelectedItem,
        itemToString: itemToString,
        onChange: onChange,
        onStateChange: this.handleStateChange,
        isFilterDisabled: this.state.isOpenedByButton
      }, autocompleteProps), function (_ref) {
        var getRef = _ref.getRef,
            isShown = _ref.isShown,
            openMenu = _ref.openMenu,
            inputValue = _ref.inputValue,
            getInputProps = _ref.getInputProps,
            getButtonProps = _ref.getButtonProps,
            clearSelection = _ref.clearSelection;
        return _react.default.createElement(_uiBox.default, (0, _extends2.default)({
          innerRef: function innerRef(ref) {
            return getRef(ref);
          },
          display: "inline-flex",
          width: width
        }, props), _react.default.createElement(_textInput.TextInput, (0, _extends2.default)({
          width: 0,
          flex: 1,
          height: height,
          value: inputValue,
          borderTopRightRadius: 0,
          borderBottomRightRadius: 0,
          disabled: disabled
        }, getInputProps((0, _objectSpread2.default)({}, inputProps, {
          placeholder: placeholder,
          onFocus: function onFocus() {
            if (openOnFocus) openMenu();
          },
          onChange: function onChange(e) {
            if (_this2.state.isOpenedByButton) {
              _this2.setState({
                isOpenedByButton: false
              });
            }

            if (e.target.value.trim() === '') {
              // Prevent the selected item from sticking around
              clearSelection();
            }
          }
        })))), _react.default.createElement(_buttons.IconButton, (0, _extends2.default)({
          iconAim: "down",
          color: "muted",
          icon: isLoading ? '' : 'caret-down',
          appearance: "default",
          height: height,
          marginLeft: -1,
          paddingLeft: isLoading ? 12 : 0,
          paddingRight: 0,
          borderTopLeftRadius: 0,
          borderBottomLeftRadius: 0,
          disabled: disabled,
          isLoading: isLoading
        }, getButtonProps((0, _objectSpread2.default)({}, buttonProps, {
          onClick: function onClick() {
            if (!isShown) {
              _this2.setState({
                isOpenedByButton: true
              });
            }
          }
        })))));
      });
    }
  }]);
  return Combobox;
}(_react.PureComponent);

exports.default = Combobox;
Combobox.displayName = "Combobox";
(0, _defineProperty2.default)(Combobox, "propTypes", (0, _objectSpread2.default)({}, _uiBox.dimensions.propTypes, _uiBox.spacing.propTypes, _uiBox.position.propTypes, _uiBox.layout.propTypes, {
  /**
   * The options to show in the menu.
   */
  items: _propTypes.default.array.isRequired,

  /**
   * The selected item when controlled.
   */
  selectedItem: _propTypes.default.any,

  /**
   * Function called when value changes.
   */
  onChange: _propTypes.default.func,

  /**
   * When true, open the autocomplete on focus.
   */
  openOnFocus: _propTypes.default.bool,

  /**
   * Default selected item when uncontrolled.
   */
  defaultSelectedItem: _propTypes.default.any,

  /**
   * The placeholder text when there is no value present.
   */
  placeholder: _propTypes.default.string,

  /**
   * In case the array of items is not an array of strings,
   * this function is used on each item to return the string that will be shown on the filter
   */
  itemToString: _propTypes.default.func,

  /**
   * Properties forwarded to the input. Use with caution.
   */
  inputProps: _propTypes.default.object,

  /**
   * Properties forwarded to the button. Use with caution.
   */
  buttonProps: _propTypes.default.object,

  /**
   * Properties forwarded to the autocomplete component. Use with caution.
   */
  autocompleteProps: _propTypes.default.object,

  /**
   * Makes the input element disabled.
   */
  disabled: _propTypes.default.bool,

  /**
   * When true, show a loading spinner. This also disables the button.
   */
  isLoading: _propTypes.default.bool
}));
(0, _defineProperty2.default)(Combobox, "defaultProps", {
  width: 240,
  openOnFocus: false,
  disabled: false,
  isLoading: false
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9jb21ib2JveC9zcmMvQ29tYm9ib3guanMiXSwibmFtZXMiOlsiQ29tYm9ib3giLCJwcm9wcyIsImNvbnRleHQiLCJjaGFuZ2VzIiwiT2JqZWN0IiwicHJvdG90eXBlIiwiaGFzT3duUHJvcGVydHkiLCJjYWxsIiwiaXNPcGVuIiwic2V0U3RhdGUiLCJpc09wZW5lZEJ5QnV0dG9uIiwic3RhdGUiLCJpdGVtcyIsInNlbGVjdGVkSXRlbSIsImRlZmF1bHRTZWxlY3RlZEl0ZW0iLCJpdGVtVG9TdHJpbmciLCJ3aWR0aCIsImhlaWdodCIsIm9uQ2hhbmdlIiwicGxhY2Vob2xkZXIiLCJpbnB1dFByb3BzIiwiYnV0dG9uUHJvcHMiLCJvcGVuT25Gb2N1cyIsImF1dG9jb21wbGV0ZVByb3BzIiwiaXNMb2FkaW5nIiwiZGlzYWJsZWQiLCJoYW5kbGVTdGF0ZUNoYW5nZSIsImdldFJlZiIsImlzU2hvd24iLCJvcGVuTWVudSIsImlucHV0VmFsdWUiLCJnZXRJbnB1dFByb3BzIiwiZ2V0QnV0dG9uUHJvcHMiLCJjbGVhclNlbGVjdGlvbiIsInJlZiIsIm9uRm9jdXMiLCJlIiwidGFyZ2V0IiwidmFsdWUiLCJ0cmltIiwib25DbGljayIsIlB1cmVDb21wb25lbnQiLCJkaW1lbnNpb25zIiwicHJvcFR5cGVzIiwic3BhY2luZyIsInBvc2l0aW9uIiwibGF5b3V0IiwiUHJvcFR5cGVzIiwiYXJyYXkiLCJpc1JlcXVpcmVkIiwiYW55IiwiZnVuYyIsImJvb2wiLCJzdHJpbmciLCJvYmplY3QiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7SUFFcUJBLFE7Ozs7O0FBK0VuQixvQkFBWUMsS0FBWixFQUFtQkMsT0FBbkIsRUFBNEI7QUFBQTs7QUFBQTtBQUMxQiw4R0FBTUQsS0FBTixFQUFhQyxPQUFiO0FBRDBCLG9HQU9SLFVBQUFDLE9BQU8sRUFBSTtB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QyxtQkFBVUcsRzs7QUFFeEI7OztBQUdBaEMsRUFBQUEsUUFBUSxFQUFFNkIsbUJBQVVJLEk7O0FBRXBCOzs7QUFHQTdCLEVBQUFBLFdBQVcsRUFBRXlCLG1CQUFVSyxJOztBQUV2Qjs7O0FBR0F0QyxFQUFBQSxtQkFBbUIsRUFBRWlDLG1CQUFVRyxHOztBQUUvQjs7O0FBR0EvQixFQUFBQSxXQUFXLEVBQUU0QixtQkFBVU0sTTs7QUFFdkI7Ozs7QUFJQXRDLEVBQUFBLFlBQVksRUFBRWdDLG1CQUFVSSxJOztBQUV4Qjs7O0FBR0EvQixFQUFBQSxVQUFVLEVBQUUyQixtQkFBVU8sTTs7QUFFdEI7OztBQUdBakMsRUFBQUEsV0FBVyxFQUFFMEIsbUJBQVVPLE07O0FBRXZCOzs7QUFHQS9CLEVBQUFBLGlCQUFpQixFQUFFd0IsbUJBQVVPLE07O0FBRTdCOzs7QUFHQTdCLEVBQUFBLFFBQVEsRUFBRXNCLG1CQUFVSyxJOztBQUVwQjs7O0FBR0E1QixFQUFBQSxTQUFTLEVBQUV1QixtQkFBVUs7OzhCQXJFSnBELFEsa0JBd0VHO0FBQ3BCZ0IsRUFBQUEsS0FBSyxFQUFFLEdBRGE7QUFFcEJNLEVBQUFBLFdBQVcsRUFBRSxLQUZPO0FBR3BCRyxFQUFBQSxRQUFRLEVBQUUsS0FIVTtBQUlwQkQsRUFBQUEsU0FBUyxFQUFFO0FBSlMsQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBSZWFjdCwgeyBQdXJlQ29tcG9uZW50IH0gZnJvbSAncmVhY3QnXG5pbXBvcnQgUHJvcFR5cGVzIGZyb20gJ3Byb3AtdHlwZXMnXG5pbXBvcnQgQm94LCB7IGRpbWVuc2lvbnMsIHNwYWNpbmcsIHBvc2l0aW9uLCBsYXlvdXQgfSBmcm9tICd1aS1ib3gnXG5pbXBvcnQgeyBBdXRvY29tcGxldGUgfSBmcm9tICcuLi8uLi9hdXRvY29tcGxldGUnXG5pbXBvcnQgeyBUZXh0SW5wdXQgfSBmcm9tICcuLi8uLi90ZXh0LWlucHV0J1xuaW1wb3J0IHsgSWNvbkJ1dHRvbiB9IGZyb20gJy4uLy4uL2J1dHRvbnMnXG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIENvbWJvYm94IGV4dGVuZHMgUHVyZUNvbXBvbmVudCB7XG4gIHN0YXRpYyBwcm9wVHlwZXMgPSB7XG4gICAgLyoqXG4gICAgICogSW1wbGVtZW50cyBzb21lIEFQSXMgZnJvbSB1aS1ib3guXG4gICAgICovXG4gICAgLi4uZGltZW5zaW9ucy5wcm9wVHlwZXMsXG4gICAgLi4uc3BhY2luZy5wcm9wVHlwZXMsXG4gICAgLi4ucG9zaXRpb24ucHJvcFR5cGVzLFxuICAgIC4uLmxheW91dC5wcm9wVHlwZXMsXG5cbiAgICAvKipcbiAgICAgKiBUaGUgb3B0aW9ucyB0byBzaG93IGluIHRoZSBtZW51LlxuICAgICAqL1xuICAgIGl0ZW1zOiBQcm9wVHlwZXMuYXJyYXkuaXNSZXF1aXJlZCxcblxuICAgIC8qKlxuICAgICAqIFRoZSBzZWxlY3RlZCBpdGVtIHdoZW4gY29udHJvbGxlZC5cbiAgICAgKi9cbiAgICBzZWxlY3RlZEl0ZW06IFByb3BUeXBlcy5hbnksXG5cbiAgICAvKipcbiAgICAgKiBGdW5jdGlvbiBjYWxsZWQgd2hlbiB2YWx1ZSBjaGFuZ2VzLlxuICAgICAqL1xuICAgIG9uQ2hhbmdlOiBQcm9wVHlwZXMuZnVuYyxcblxuICAgIC8qKlxuICAgICAqIFdoZW4gdHJ1ZSwgb3BlbiB0aGUgYXV0b2NvbXBsZXRlIG9uIGZvY3VzLlxuICAgICAqL1xuICAgIG9wZW5PbkZvY3VzOiBQcm9wVHlwZXMuYm9vbCxcblxuICAgIC8qKlxuICAgICAqIERlZmF1bHQgc2VsZWN0ZWQgaXRlbSB3aGVuIHVuY29udHJvbGxlZC5cbiAgICAgKi9cbiAgICBkZWZhdWx0U2VsZWN0ZWRJdGVtOiBQcm9wVHlwZXMuYW55LFxuXG4gICAgLyoqXG4gICAgICogVGhlIHBsYWNlaG9sZGVyIHRleHQgd2hlbiB0aGVyZSBpcyBubyB2YWx1ZSBwcmVzZW50LlxuICAgICAqL1xuICAgIHBsYWNlaG9sZGVyOiBQcm9wVHlwZXMuc3RyaW5nLFxuXG4gICAgLyoqXG4gICAgICogSW4gY2FzZSB0aGUgYXJyYXkgb2YgaXRlbXMgaXMgbm90IGFuIGFycmF5IG9mIHN0cmluZ3MsXG4gICAgICogdGhpcyBmdW5jdGlvbiBpcyB1c2VkIG9uIGVhY2ggaXRlbSB0byByZXR1cm4gdGhlIHN0cmluZyB0aGF0IHdpbGwgYmUgc2hvd24gb24gdGhlIGZpbHRlclxuICAgICAqL1xuICAgIGl0ZW1Ub1N0cmluZzogUHJvcFR5cGVzLmZ1bmMsXG5cbiAgICAvKipcbiAgICAgKiBQcm9wZXJ0aWVzIGZvcndhcmRlZCB0byB0aGUgaW5wdXQuIFVzZSB3aXRoIGNhdXRpb24uXG4gICAgICovXG4gICAgaW5wdXRQcm9wczogUHJvcFR5cGVzLm9iamVjdCxcblxuICAgIC8qKlxuICAgICAqIFByb3BlcnRpZXMgZm9yd2FyZGVkIHRvIHRoZSBidXR0b24uIFVzZSB3aXRoIGNhdXRpb24uXG4gICAgICovXG4gICAgYnV0dG9uUHJvcHM6IFByb3BUeXBlcy5vYmplY3QsXG5cbiAgICAvKipcbiAgICAgKiBQcm9wZXJ0aWVzIGZvcndhcmRlZCB0byB0aGUgYXV0b2NvbXBsZXRlIGNvbXBvbmVudC4gVXNlIHdpdGggY2F1dGlvbi5cbiAgICAgKi9cbiAgICBhdXRvY29tcGxldGVQcm9wczogUHJvcFR5cGVzLm9iamVjdCxcblxuICAgIC8qKlxuICAgICAqIE1ha2VzIHRoZSBpbnB1dCBlbGVtZW50IGRpc2FibGVkLlxuICAgICAqL1xuICAgIGRpc2FibGVkOiBQcm9wVHlwZXMuYm9vbCxcblxuICAgIC8qKlxuICAgICAqIFdoZW4gdHJ1ZSwgc2hvdyBhIGxvYWRpbmcgc3Bpbm5lci4gVGhpcyBhbHNvIGRpc2FibGVzIHRoZSBidXR0b24uXG4gICAgICovXG4gICAgaXNMb2FkaW5nOiBQcm9wVHlwZXMuYm9vbFxuICB9XG5cbiAgc3RhdGljIGRlZmF1bHRQcm9wcyA9IHtcbiAgICB3aWR0aDogMjQwLFxuICAgIG9wZW5PbkZvY3VzOiBmYWxzZSxcbiAgICBkaXNhYmxlZDogZmFsc2UsXG4gICAgaXNMb2FkaW5nOiBmYWxzZVxuICB9XG5cbiAgY29uc3RydWN0b3IocHJvcHMsIGNvbnRleHQpIHtcbiAgICBzdXBlcihwcm9wcywgY29udGV4dClcbiAgICB0aGlzLnN0YXRlID0ge1xuICAgICAgaXNPcGVuZWRCeUJ1dHRvbjogZmFsc2VcbiAgICB9XG4gIH1cblxuICBoYW5kbGVTdGF0ZUNoYW5nZSA9IGNoYW5nZXMgPT4ge1xuICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoY2hhbmdlcywgJ2lzT3BlbicpKSB7XG4gICAgICBpZiAoIWNoYW5nZXMuaXNPcGVuKSB7XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoeyBpc09wZW5lZEJ5QnV0dG9uOiBmYWxzZSB9KVxuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHJlbmRlcigpIHtcbiAgICBjb25zdCB7XG4gICAgICBpdGVtcyxcbiAgICAgIHNlbGVjdGVkSXRlbSxcbiAgICAgIGRlZmF1bHRTZWxlY3RlZEl0ZW0sXG4gICAgICBpdGVtVG9TdHJpbmcsXG4gICAgICB3aWR0aCxcbiAgICAgIGhlaWdodCxcbiAgICAgIG9uQ2hhbmdlLFxuICAgICAgcGxhY2Vob2xkZXIsXG4gICAgICBpbnB1dFByb3BzLFxuICAgICAgYnV0dG9uUHJvcHMsXG4gICAgICBvcGVuT25Gb2N1cyxcbiAgICAgIGF1dG9jb21wbGV0ZVByb3BzLFxuICAgICAgaXNMb2FkaW5nLFxuICAgICAgLi4ucHJvcHNcbiAgICB9ID0gdGhpcy5wcm9wc1xuXG4gICAgY29uc3QgZGlzYWJsZWQgPSBwcm9wcy5kaXNhYmxlZCB8fCBpc0xvYWRpbmdcblxuICAgIHJldHVybiAoXG4gICAgICA8QXV0b2NvbXBsZXRlXG4gICAgICAgIGl0ZW1zPXtpdGVtc31cbiAgICAgICAgc2VsZWN0ZWRJdGVtPXtzZWxlY3RlZEl0ZW19XG4gICAgICAgIGRlZmF1bHRTZWxlY3RlZEl0ZW09e2RlZmF1bHRTZWxlY3RlZEl0ZW19XG4gICAgICAgIGl0ZW1Ub1N0cmluZz17aXRlbVRvU3RyaW5nfVxuICAgICAgICBvbkNoYW5nZT17b25DaGFuZ2V9XG4gICAgICAgIG9uU3RhdGVDaGFuZ2U9e3RoaXMuaGFuZGxlU3RhdGVDaGFuZ2V9XG4gICAgICAgIGlzRmlsdGVyRGlzYWJsZWQ9e3RoaXMuc3RhdGUuaXNPcGVuZWRCeUJ1dHRvbn1cbiAgICAgICAgey4uLmF1dG9jb21wbGV0ZVByb3BzfVxuICAgICAgPlxuICAgICAgICB7KHtcbiAgICAgICAgICBnZXRSZWYsXG4gICAgICAgICAgaXNTaG93bixcbiAgICAgICAgICBvcGVuTWVudSxcbiAgICAgICAgICBpbnB1dFZhbHVlLFxuICAgICAgICAgIGdldElucHV0UHJvcHMsXG4gICAgICAgICAgZ2V0QnV0dG9uUHJvcHMsXG4gICAgICAgICAgY2xlYXJTZWxlY3Rpb25cbiAgICAgICAgfSkgPT4gKFxuICAgICAgICAgIDxCb3hcbiAgICAgICAgICAgIGlubmVyUmVmPXtyZWYgPT4gZ2V0UmVmKHJlZil9XG4gICAgICAgICAgICBkaXNwbGF5PVwiaW5saW5lLWZsZXhcIlxuICAgICAgICAgICAgd2lkdGg9e3dpZHRofVxuICAgICAgICAgICAgey4uLnByb3BzfVxuICAgICAgICAgID5cbiAgICAgICAgICAgIDxUZXh0SW5wdXRcbiAgICAgICAgICAgICAgd2lkdGg9ezB9XG4gICAgICAgICAgICAgIGZsZXg9ezF9XG4gICAgICAgICAgICAgIGhlaWdodD17aGVpZ2h0fVxuICAgICAgICAgICAgICB2YWx1ZT17aW5wdXRWYWx1ZX1cbiAgICAgICAgICAgICAgYm9yZGVyVG9wUmlnaHRSYWRpdXM9ezB9XG4gICAgICAgICAgICAgIGJvcmRlckJvdHRvbVJpZ2h0UmFkaXVzPXswfVxuICAgICAgICAgICAgICBkaXNhYmxlZD17ZGlzYWJsZWR9XG4gICAgICAgICAgICAgIHsuLi5nZXRJbnB1dFByb3BzKHtcbiAgICAgICAgICAgICAgICAuLi5pbnB1dFByb3BzLFxuICAgICAgICAgICAgICAgIHBsYWNlaG9sZGVyLFxuICAgICAgICAgICAgICAgIG9uRm9jdXM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICAgIGlmIChvcGVuT25Gb2N1cykgb3Blbk1lbnUoKVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgb25DaGFuZ2U6IGUgPT4ge1xuICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuc3RhdGUuaXNPcGVuZWRCeUJ1dHRvbikge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgICAgICAgICAgICAgICBpc09wZW5lZEJ5QnV0dG9uOiBmYWxzZVxuICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICBpZiAoZS50YXJnZXQudmFsdWUudHJpbSgpID09PSAnJykge1xuICAgICAgICAgICAgICAgICAgICAvLyBQcmV2ZW50IHRoZSBzZWxlY3RlZCBpdGVtIGZyb20gc3RpY2tpbmcgYXJvdW5kXG4gICAgICAgICAgICAgICAgICAgIGNsZWFyU2VsZWN0aW9uKClcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH0pfVxuICAgICAgICAgICAgLz5cbiAgICAgICAgICAgIDxJY29uQnV0dG9uXG4gICAgICAgICAgICAgIGljb25BaW09XCJkb3duXCJcbiAgICAgICAgICAgICAgY29sb3I9XCJtdXRlZFwiXG4gICAgICAgICAgICAgIGljb249e2lzTG9hZGluZyA/ICcnIDogJ2NhcmV0LWRvd24nfVxuICAgICAgICAgICAgICBhcHBlYXJhbmNlPVwiZGVmYXVsdFwiXG4gICAgICAgICAgICAgIGhlaWdodD17aGVpZ2h0fVxuICAgICAgICAgICAgICBtYXJnaW5MZWZ0PXstMX1cbiAgICAgICAgICAgICAgcGFkZGluZ0xlZnQ9e2lzTG9hZGluZyA/IDEyIDogMH1cbiAgICAgICAgICAgICAgcGFkZGluZ1JpZ2h0PXswfVxuICAgICAgICAgICAgICBib3JkZXJUb3BMZWZ0UmFkaXVzPXswfVxuICAgICAgICAgICAgICBib3JkZXJCb3R0b21MZWZ0UmFkaXVzPXswfVxuICAgICAgICAgICAgICBkaXNhYmxlZD17ZGlzYWJsZWR9XG4gICAgICAgICAgICAgIGlzTG9hZGluZz17aXNMb2FkaW5nfVxuICAgICAgICAgICAgICB7Li4uZ2V0QnV0dG9uUHJvcHMoe1xuICAgICAgICAgICAgICAgIC4uLmJ1dHRvblByb3BzLFxuICAgICAgICAgICAgICAgIG9uQ2xpY2s6ICgpID0+IHtcbiAgICAgICAgICAgICAgICAgIGlmICghaXNTaG93bikge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNldFN0YXRlKHsgaXNPcGVuZWRCeUJ1dHRvbjogdHJ1ZSB9KVxuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfSl9XG4gICAgICAgICAgICAvPlxuICAgICAgICAgIDwvQm94PlxuICAgICAgICApfVxuICAgICAgPC9BdXRvY29tcGxldGU+XG4gICAgKVxuICB9XG59XG4iXX0=