import _extends from "@babel/runtime/helpers/esm/extends";
import _objectSpread from "@babel/runtime/helpers/esm/objectSpread";
import _objectWithoutProperties from "@babel/runtime/helpers/esm/objectWithoutProperties";
import _classCallCheck from "@babel/runtime/helpers/esm/classCallCheck";
import _createClass from "@babel/runtime/helpers/esm/createClass";
import _possibleConstructorReturn from "@babel/runtime/helpers/esm/possibleConstructorReturn";
import _getPrototypeOf from "@babel/runtime/helpers/esm/getPrototypeOf";
import _assertThisInitialized from "@babel/runtime/helpers/esm/assertThisInitialized";
import _inherits from "@babel/runtime/helpers/esm/inherits";
import _defineProperty from "@babel/runtime/helpers/esm/defineProperty";
import React, { PureComponent } from 'react';
import PropTypes from 'prop-types';
import Box, { dimensions, spacing, position, layout } from 'ui-box';
import { Autocomplete } from '../../autocomplete';
import { TextInput } from '../../text-input';
import { IconButton } from '../../buttons';

var Combobox =
/*#__PURE__*/
function (_PureComponent) {
  _inherits(Combobox, _PureComponent);

  function Combobox(props, context) {
    var _this;

    _classCallCheck(this, Combobox);

    _this = _possibleConstructorReturn(this, _getPrototypeOf(Combobox).call(this, props, context));

    _defineProperty(_assertThisInitialized(_this), "handleStateChange", function (changes) {
      if (Object.prototype.hasOwnProperty.call(changes, 'isOpen')) {
        if (!changes.isOpen) {
          _this.setState({
            isOpenedByButton: false
          });
        }
      }
    });

    _this.state = {
      isOpenedByButton: false
    };
    return _this;
  }

  _createClass(Combobox, [{
    key: "render",
    value: function render() {
      var _this2 = this;

      var _this$props = this.props,
          items = _this$props.items,
          selectedItem = _this$props.selectedItem,
          defaultSelectedItem = _this$props.defaultSelectedItem,
          itemToString = _this$props.itemToString,
          width = _this$props.width,
          height = _this$props.height,
          onChange = _this$props.onChange,
          placeholder = _this$props.placeholder,
          inputProps = _this$props.inputProps,
          buttonProps = _this$props.buttonProps,
          openOnFocus = _this$props.openOnFocus,
          autocompleteProps = _this$props.autocompleteProps,
          isLoading = _this$props.isLoading,
          props = _objectWithoutProperties(_this$props, ["items", "selectedItem", "defaultSelectedItem", "itemToString", "width", "height", "onChange", "placeholder", "inputProps", "buttonProps", "openOnFocus", "autocompleteProps", "isLoading"]);

      var disabled = props.disabled || isLoading;
      return React.createElement(Autocomplete, _extends({
        items: items,
        selectedItem: selectedItem,
        defaultSelectedItem: defaultSelectedItem,
        itemToString: itemToString,
        onChange: onChange,
        onStateChange: this.handleStateChange,
        isFilterDisabled: this.state.isOpenedByButton
      }, autocompleteProps), function (_ref) {
        var getRef = _ref.getRef,
            isShown = _ref.isShown,
            openMenu = _ref.openMenu,
            inputValue = _ref.inputValue,
            getInputProps = _ref.getInputProps,
            getButtonProps = _ref.getButtonProps,
            clearSelection = _ref.clearSelection;
        return React.createElement(Box, _extends({
          innerRef: function innerRef(ref) {
            return getRef(ref);
          },
          display: "inline-flex",
          width: width
        }, props), React.createElement(TextInput, _extends({
          width: 0,
          flex: 1,
          height: height,
          value: inputValue,
          borderTopRightRadius: 0,
          borderBottomRightRadius: 0,
          disabled: disabled
        }, getInputProps(_objectSpread({}, inputProps, {
          placeholder: placeholder,
          onFocus: function onFocus() {
            if (openOnFocus) openMenu();
          },
          onChange: function onChange(e) {
            if (_this2.state.isOpenedByButton) {
              _this2.setState({
                isOpenedByButton: false
              });
            }

            if (e.target.value.trim() === '') {
              // Prevent the selected item from sticking around
              clearSelection();
            }
          }
        })))), React.createElement(IconButton, _extends({
          iconAim: "down",
          color: "muted",
          icon: isLoading ? '' : 'caret-down',
          appearance: "default",
          height: height,
          marginLeft: -1,
          paddingLeft: isLoading ? 12 : 0,
          paddingRight: 0,
          borderTopLeftRadius: 0,
          borderBottomLeftRadius: 0,
          disabled: disabled,
          isLoading: isLoading
        }, getButtonProps(_objectSpread({}, buttonProps, {
          onClick: function onClick() {
            if (!isShown) {
              _this2.setState({
                isOpenedByButton: true
              });
            }
          }
        })))));
      });
    }
  }]);

  return Combobox;
}(PureComponent);

Combobox.displayName = "Combobox";

_defineProperty(Combobox, "propTypes", _objectSpread({}, dimensions.propTypes, spacing.propTypes, position.propTypes, layout.propTypes, {
  /**
   * The options to show in the menu.
   */
  items: PropTypes.array.isRequired,

  /**
   * The selected item when controlled.
   */
  selectedItem: PropTypes.any,

  /**
   * Function called when value changes.
   */
  onChange: PropTypes.func,

  /**
   * When true, open the autocomplete on focus.
   */
  openOnFocus: PropTypes.bool,

  /**
   * Default selected item when uncontrolled.
   */
  defaultSelectedItem: PropTypes.any,

  /**
   * The placeholder text when there is no value present.
   */
  placeholder: PropTypes.string,

  /**
   * In case the array of items is not an array of strings,
   * this function is used on each item to return the string that will be shown on the filter
   */
  itemToString: PropTypes.func,

  /**
   * Properties forwarded to the input. Use with caution.
   */
  inputProps: PropTypes.object,

  /**
   * Properties forwarded to the button. Use with caution.
   */
  buttonProps: PropTypes.object,

  /**
   * Properties forwarded to the autocomplete component. Use with caution.
   */
  autocompleteProps: PropTypes.object,

  /**
   * Makes the input element disabled.
   */
  disabled: PropTypes.bool,

  /**
   * When true, show a loading spinner. This also disables the button.
   */
  isLoading: PropTypes.bool
}));

_defineProperty(Combobox, "defaultProps", {
  width: 240,
  openOnFocus: false,
  disabled: false,
  isLoading: false
});

export { Combobox as default };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9jb21ib2JveC9zcmMvQ29tYm9ib3guanMiXSwibmFtZXMiOlsiUmVhY3QiLCJQdXJlQ29tcG9uZW50IiwiUHJvcFR5cGVzIiwiQm94IiwiZGltZW5zaW9ucyIsInNwYWNpbmciLCJwb3NpdGlvbiIsImxheW91dCIsIkF1dG9jb21wbGV0ZSIsIlRleHRJbnB1dCIsIkljb25CdXR0b24iLCJDb21ib2JveCIsInByb3BzIiwiY29udGV4dCIsImNoYW5nZXMiLCJPYmplY3QiLCJwcm90b3R5cGUiLCJoYXNPd25Qcm9wZXJ0eSIsImNhbGwiLCJpc09wZW4iLCJzZXRTdGF0ZSIsImlzT3BlbmVkQnlCdXR0b24iLCJzdGF0ZSIsIml0ZW1zIiwic2VsZWN0ZWRJdGVtIiwiZGVmYXVsdFNlbGVjdGVkSXRlbSIsIml0ZW1Ub1N0cmluZyIsIndpZHRoIiwiaGVpZ2h0Iiwib25DaGFuZ2UiLCJwbGFjZWhvbGRlciIsImlucHV0UHJvcHMiLCJidXR0b25Qcm9wcyIsIm9wZW5PbkZvY3VzIiwiYXV0b2NvbXBsZXRlUHJvcHMiLCJpc0xvYWRpbmciLCJkaXNhYmxlZCIsImhhbmRsZVN0YXRlQ2hhbmdlIiwiZ2V0UmVmIiwiaXNTaG93biIsIm9wZW5NZW51IiwiaW5wdXRWYWx1ZSIsImdldElucHV0UHJvcHMiLCJnZXRCdXR0b25Qcm9wcyIsImNsZWFyU2VsZWN0aW9uIiwicmVmIiwib25Gb2N1cyIsImUiLCJ0YXJnZXQiLCJ2YWx1ZSIsInRyaW0iLCJvbkNsaWNrIiwicHJvcFR5cGVzIiwiYXJyYXkiLCJpc1JlcXVpcmVkIiwiYW55IiwiZnVuYyIsImJvb2wiLCJzdHJpbmciLCJvYmplY3QiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7QUFBQSxPQUFPQSxLQUFQLElBQWdCQyxhQUFoQixRQUFxQyxPQUFyQztBQUNBLE9BQU9DLFNBQVAsTUFBc0IsWUFBdEI7QUFDQSxPQUFPQyxHQUFQLElBQWNDLFVBQWQsRUFBMEJDLE9BQTFCLEVBQW1DQyxRQUFuQyxFQUE2Q0MsTUFBN0MsUUFBMkQsUUFBM0Q7QUFDQSxTQUFTQyxZQUFULFFBQTZCLG9CQUE3QjtBQUNBLFNBQVNDLFNBQVQsUUFBMEIsa0JBQTFCO0FBQ0EsU0FBU0MsVUFBVCxRQUEyQixlQUEzQjs7SUFFcUJDLFE7Ozs7O0FBK0VuQixvQkFBWUMsS0FBWixFQUFtQkMsT0FBbkIsRUFBNEI7QUFBQTs7QUFBQTs7QUFDMUIsa0ZBQU1ELEtBQU4sRUFBYUMsT0FBYjs7QUFEMEIsd0VBT1IsVUFBQUMsT0FBTyxFQUFJO0FBQzdCLFVBQUlDLE1BQU0sQ0FBQ0MsU0FBUCxDQUFpQkMsY0FBakIsQ0FBZ0NDLElBQWhDLENBQXFDSixPQUFyQyxFQUE4QyxRQUE5QyxDQUFKLEVBQTZEO0FBQzNELFlBQUksQ0FBQ0EsT0FBTyxDQUFDSyxNQUFiLEVBQXFCO0FBQ25CLGdCQUFLQyxRQUFMLENBQWM7QUFBRUMsWUFBQUEsZ0JBQWdCLEVBQUU7QUFBcEIsV0FBZDtBQUNEO0FBQ0Y7QUFDRixLQWIyQjs7QUFFMUIsVUFBS0MsS0FBTCxHQUFhO0FBQ1hELE1BQUFBLGdCQUFnQixFQUFFO0FBRFAsS0FBYjtBQUYwQjtBQUszQjs7Ozs2QkFVUTtBQUFBOztBQUFBLHdCQWdCSCxLQUFLVCxLQWhCRjtBQUFBLFVBRUxXLEtBRkssZUFFTEEsS0FGSztBQUFBLFVBR0xDLFlBSEssZUFHTEEsWUFISztBQUFBLFVBSUxDLG1CQUpLLGVBSUxBLG1CQUpLO0FBQUEsVUFLTEMsWUFMSyxlQUtMQSxZQUxLO0FBQUEsVUFNTEMsS0FOSyxlQU1MQSxLQU5LO0FBQUEsVUFPTEMsTUFQSyxlQU9MQSxNQVBLO0FBQUEsVUFRTEMsUUFSSyxlQVFMQSxRQVJLO0FBQUEsVUFTTEMsV0FUSyxlQVNMQSxXQVRLO0FBQUEsVUFVTEMsVUFWSyxlQVVMQSxVQVZLO0FBQUEsVUFXTEMsV0FYSyxlQVdMQSxXQVhLO0FBQUEsVUFZTEMsV0FaSyxlQVlMQSxXQVpLO0FBQUEsVUFhTEMsaUJBYkssZUFhTEEsaUJBYks7QUFBQSxVQWNMQyxTQWRLLGVBY0xBLFNBZEs7QUFBQSxVQWVGdkIsS0FmRTs7QUFrQlAsVUFBTXdCLFFBQVEsR0FBR3hCLEtBQUssQ0FBQ3dCLFFBQU4sSUFBa0JELFNBQW5DO0FBRUEsYUFDRSxvQkFBQyxZQUFEO0FBQ0UsUUFBQSxLQUFLLEVBQUVaLEtBRFQ7QUFFRSxRQUFBLFlBQVksRUFBRUMsWUFGaEI7QUFHRSxRQUFBLG1CQUFtQixFQUFFQyxtQkFIdkI7QUFJRSxRQUFBLFlBQVksRUFBRUMsWUFKaEI7QUFLRSxRQUFBLFFBQVEsRUFBRUcsUUFMWjtBQU1FLFFBQUEsYUFBYSxFQUFFLEtBQUtRLGlCQU50QjtBQU9FLFFBQUEsZ0JBQWdCLEVBQUUsS0FBS2YsS0FBTCxDQUFXRDtBQVAvQixTQVFNYSxpQkFSTixHQVVHO0FBQUEsWUFDQ0ksTUFERCxRQUNDQSxNQUREO0FBQUEsWUFFQ0MsT0FGRCxRQUVDQSxPQUZEO0FBQUEsWUFHQ0MsUUFIRCxRQUdDQSxRQUhEO0FBQUEsWUFJQ0MsVUFKRCxRQUlDQSxVQUpEO0FBQUEsWUFLQ0MsYUFMRCxRQUtDQSxhQUxEO0FBQUEsWUFNQ0MsY0FORCxRQU1DQSxjQU5EO0FBQUEsWUFPQ0MsY0FQRCxRQU9DQSxjQVBEO0FBQUEsZUFTQyxvQkFBQyxHQUFEO0FBQ0UsVUFBQSxRQUFRLEVBQUUsa0JBQUFDLEdBQUc7QUFBQSxtQkFBSVAsTUFBTSxDQUFDTyxHQUFELENBQVY7QUFBQSxXQURmO0FBRUUsVUFBQSxPQUFPLEVBQUMsYUFGVjtBQUdFLFVBQUEsS0FBSyxFQUFFbEI7QUFIVCxXQUlNZixLQUpOLEdBTUUsb0JBQUMsU0FBRDtBQUNFLFVBQUEsS0FBSyxFQUFFLENBRFQ7QUFFRSxVQUFBLElBQUksRUFBRSxDQUZSO0FBR0UsVUFBQSxNQUFNLEVBQUVnQixNQUhWO0FBSUUsVUFBQSxLQUFLLEVBQUVhLFVBSlQ7QUFLRSxVQUFBLG9CQUFvQixFQUFFLENBTHhCO0FBTUUsVUFBQSx1QkFBdUIsRUFBRSxDQU4zQjtBQU9FLFVBQUEsUUFBUSxFQUFFTDtBQVBaLFdBUU1NLGFBQWEsbUJBQ1pYLFVBRFk7QUFFZkQsVUFBQUEsV0FBVyxFQUFYQSxXQUZlO0FBR2ZnQixVQUFBQSxPQUFPLEVBQUUsbUJBQU07QUFDYixnQkFBSWIsV0FBSixFQUFpQk8sUUFBUTtBQUMxQixXQUxjO0FBTWZYLFVBQUFBLFFBQVEsRUFBRSxrQkFBQWtCLENBQUMsRUFBSTtBQUNiLGdCQUFJLE1BQUksQ0FBQ3pCLEtBQUwsQ0FBV0QsZ0JBQWYsRUFBaUM7QUFDL0IsY0FBQSxNQUFJLENBQUNELFFBQUwsQ0FBYztBQUNaQyxnQkFBQUEsZ0JBQWdCLEVBQUU7QUFETixlQUFkO0FBR0Q7O0FBRUQsZ0JBQUkwQixDQUFDLENBQUNDLE1BQUYsQ0FBU0MsS0FBVCxDQUFlQyxJQUFmLE9BQTBCLEVBQTlCLEVBQWtDO0FBQ2hDO0FBQ0FOLGNBQUFBLGNBQWM7QUFDZjtBQUNGO0FBakJjLFdBUm5CLEVBTkYsRUFrQ0Usb0JBQUMsVUFBRDtBQUNFLFVBQUEsT0FBTyxFQUFDLE1BRFY7QUFFRSxVQUFBLEtBQUssRUFBQyxPQUZSO0FBR0UsVUFBQSxJQUFJLEVBQUVULFNBQVMsR0FBRyxFQUFILEdBQVEsWUFIekI7QUFJRSxVQUFBLFVBQVUsRUFBQyxTQUpiO0FBS0UsVUFBQSxNQUFNLEVBQUVQLE1BTFY7QUFNRSxVQUFBLFVBQVUsRUFBRSxDQUFDLENBTmY7QUFPRSxVQUFBLFdBQVcsRUFBRU8sU0FBUyxHQUFHLEVBQUgsR0FBUSxDQVBoQztBQVFFLFVBQUEsWUFBWSxFQUFFLENBUmhCO0FBU0UsVUFBQSxtQkFBbUIsRUFBRSxDQVR2QjtBQVVFLFVBQUEsc0JBQXNCLEVBQUUsQ0FWMUI7QUFXRSxVQUFBLFFBQVEsRUFBRUMsUUFYWjtBQVlFLFVBQUEsU0FBUyxFQUFFRDtBQVpiLFdBYU1RLGNBQWMsbUJBQ2JYLFdBRGE7QUFFaEJtQixVQUFBQSxPQUFPLEVBQUUsbUJBQU07QUFDYixnQkFBSSxDQUFDWixPQUFMLEVBQWM7QUFDWixjQUFBLE1BQUksQ0FBQ25CLFFBQUwsQ0FBYztBQUFFQyxnQkFBQUEsZ0JBQWdCLEVBQUU7QUFBcEIsZUFBZDtBQUNEO0FBQ0Y7QUFOZSxXQWJwQixFQWxDRixDQVREO0FBQUEsT0FWSCxDQURGO0FBZ0ZEOzs7O0VBbE1tQ3BCLGE7O0FBQWpCVSxROztnQkFBQUEsUSxpQ0FLZFAsVUFBVSxDQUFDZ0QsUyxFQUNYL0MsT0FBTyxDQUFDK0MsUyxFQUNSOUMsUUFBUSxDQUFDOEMsUyxFQUNUN0MsTUFBTSxDQUFDNkMsUztBQUVWOzs7QUFHQTdCLEVBQUFBLEtBQUssRUFBRXJCLFNBQVMsQ0FBQ21ELEtBQVYsQ0FBZ0JDLFU7O0FBRXZCOzs7QUFHQTlCLEVBQUFBLFlBQVksRUFBRXRCLFNBQVMsQ0FBQ3FELEc7O0FBRXhCOzs7QUFHQTFCLEVBQUFBLFFBQVEsRUFBRTNCLFNBQVMsQ0FBQ3NELEk7O0FBRXBCOzs7QUFHQXZCLEVBQUFBLFdBQVcsRUFBRS9CLFNBQVMsQ0FBQ3VELEk7O0FBRXZCOzs7QUFHQWhDLEVBQUFBLG1CQUFtQixFQUFFdkIsU0FBUyxDQUFDcUQsRzs7QUFFL0I7OztBQUdBekIsRUFBQUEsV0FBVyxFQUFFNUIsU0FBUyxDQUFDd0QsTTs7QUFFdkI7Ozs7QUFJQWhDLEVBQUFBLFlBQVksRUFBRXhCLFNBQVMsQ0FBQ3NELEk7O0FBRXhCOzs7QUFHQXpCLEVBQUFBLFVBQVUsRUFBRTdCLFNBQVMsQ0FBQ3lELE07O0FBRXRCOzs7QUFHQTNCLEVBQUFBLFdBQVcsRUFBRTlCLFNBQVMsQ0FBQ3lELE07O0FBRXZCOzs7QUFHQXpCLEVBQUFBLGlCQUFpQixFQUFFaEMsU0FBUyxDQUFDeUQsTTs7QUFFN0I7OztBQUdBdkIsRUFBQUEsUUFBUSxFQUFFbEMsU0FBUyxDQUFDdUQsSTs7QUFFcEI7OztBQUdBdEIsRUFBQUEsU0FBUyxFQUFFakMsU0FBUyxDQUFDdUQ7OztnQkFyRUo5QyxRLGtCQXdFRztBQUNwQmdCLEVBQUFBLEtBQUssRUFBRSxHQURhO0FBRXBCTSxFQUFBQSxXQUFXLEVBQUUsS0FGTztBQUdwQkcsRUFBQUEsUUFBUSxFQUFFLEtBSFU7QUFJcEJELEVBQUFBLFNBQVMsRUFBRTtBQUpTLEM7O1NBeEVIeEIsUSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBSZWFjdCwgeyBQdXJlQ29tcG9uZW50IH0gZnJvbSAncmVhY3QnXG5pbXBvcnQgUHJvcFR5cGVzIGZyb20gJ3Byb3AtdHlwZXMnXG5pbXBvcnQgQm94LCB7IGRpbWVuc2lvbnMsIHNwYWNpbmcsIHBvc2l0aW9uLCBsYXlvdXQgfSBmcm9tICd1aS1ib3gnXG5pbXBvcnQgeyBBdXRvY29tcGxldGUgfSBmcm9tICcuLi8uLi9hdXRvY29tcGxldGUnXG5pbXBvcnQgeyBUZXh0SW5wdXQgfSBmcm9tICcuLi8uLi90ZXh0LWlucHV0J1xuaW1wb3J0IHsgSWNvbkJ1dHRvbiB9IGZyb20gJy4uLy4uL2J1dHRvbnMnXG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIENvbWJvYm94IGV4dGVuZHMgUHVyZUNvbXBvbmVudCB7XG4gIHN0YXRpYyBwcm9wVHlwZXMgPSB7XG4gICAgLyoqXG4gICAgICogSW1wbGVtZW50cyBzb21lIEFQSXMgZnJvbSB1aS1ib3guXG4gICAgICovXG4gICAgLi4uZGltZW5zaW9ucy5wcm9wVHlwZXMsXG4gICAgLi4uc3BhY2luZy5wcm9wVHlwZXMsXG4gICAgLi4ucG9zaXRpb24ucHJvcFR5cGVzLFxuICAgIC4uLmxheW91dC5wcm9wVHlwZXMsXG5cbiAgICAvKipcbiAgICAgKiBUaGUgb3B0aW9ucyB0byBzaG93IGluIHRoZSBtZW51LlxuICAgICAqL1xuICAgIGl0ZW1zOiBQcm9wVHlwZXMuYXJyYXkuaXNSZXF1aXJlZCxcblxuICAgIC8qKlxuICAgICAqIFRoZSBzZWxlY3RlZCBpdGVtIHdoZW4gY29udHJvbGxlZC5cbiAgICAgKi9cbiAgICBzZWxlY3RlZEl0ZW06IFByb3BUeXBlcy5hbnksXG5cbiAgICAvKipcbiAgICAgKiBGdW5jdGlvbiBjYWxsZWQgd2hlbiB2YWx1ZSBjaGFuZ2VzLlxuICAgICAqL1xuICAgIG9uQ2hhbmdlOiBQcm9wVHlwZXMuZnVuYyxcblxuICAgIC8qKlxuICAgICAqIFdoZW4gdHJ1ZSwgb3BlbiB0aGUgYXV0b2NvbXBsZXRlIG9uIGZvY3VzLlxuICAgICAqL1xuICAgIG9wZW5PbkZvY3VzOiBQcm9wVHlwZXMuYm9vbCxcblxuICAgIC8qKlxuICAgICAqIERlZmF1bHQgc2VsZWN0ZWQgaXRlbSB3aGVuIHVuY29udHJvbGxlZC5cbiAgICAgKi9cbiAgICBkZWZhdWx0U2VsZWN0ZWRJdGVtOiBQcm9wVHlwZXMuYW55LFxuXG4gICAgLyoqXG4gICAgICogVGhlIHBsYWNlaG9sZGVyIHRleHQgd2hlbiB0aGVyZSBpcyBubyB2YWx1ZSBwcmVzZW50LlxuICAgICAqL1xuICAgIHBsYWNlaG9sZGVyOiBQcm9wVHlwZXMuc3RyaW5nLFxuXG4gICAgLyoqXG4gICAgICogSW4gY2FzZSB0aGUgYXJyYXkgb2YgaXRlbXMgaXMgbm90IGFuIGFycmF5IG9mIHN0cmluZ3MsXG4gICAgICogdGhpcyBmdW5jdGlvbiBpcyB1c2VkIG9uIGVhY2ggaXRlbSB0byByZXR1cm4gdGhlIHN0cmluZyB0aGF0IHdpbGwgYmUgc2hvd24gb24gdGhlIGZpbHRlclxuICAgICAqL1xuICAgIGl0ZW1Ub1N0cmluZzogUHJvcFR5cGVzLmZ1bmMsXG5cbiAgICAvKipcbiAgICAgKiBQcm9wZXJ0aWVzIGZvcndhcmRlZCB0byB0aGUgaW5wdXQuIFVzZSB3aXRoIGNhdXRpb24uXG4gICAgICovXG4gICAgaW5wdXRQcm9wczogUHJvcFR5cGVzLm9iamVjdCxcblxuICAgIC8qKlxuICAgICAqIFByb3BlcnRpZXMgZm9yd2FyZGVkIHRvIHRoZSBidXR0b24uIFVzZSB3aXRoIGNhdXRpb24uXG4gICAgICovXG4gICAgYnV0dG9uUHJvcHM6IFByb3BUeXBlcy5vYmplY3QsXG5cbiAgICAvKipcbiAgICAgKiBQcm9wZXJ0aWVzIGZvcndhcmRlZCB0byB0aGUgYXV0b2NvbXBsZXRlIGNvbXBvbmVudC4gVXNlIHdpdGggY2F1dGlvbi5cbiAgICAgKi9cbiAgICBhdXRvY29tcGxldGVQcm9wczogUHJvcFR5cGVzLm9iamVjdCxcblxuICAgIC8qKlxuICAgICAqIE1ha2VzIHRoZSBpbnB1dCBlbGVtZW50IGRpc2FibGVkLlxuICAgICAqL1xuICAgIGRpc2FibGVkOiBQcm9wVHlwZXMuYm9vbCxcblxuICAgIC8qKlxuICAgICAqIFdoZW4gdHJ1ZSwgc2hvdyBhIGxvYWRpbmcgc3Bpbm5lci4gVGhpcyBhbHNvIGRpc2FibGVzIHRoZSBidXR0b24uXG4gICAgICovXG4gICAgaXNMb2FkaW5nOiBQcm9wVHlwZXMuYm9vbFxuICB9XG5cbiAgc3RhdGljIGRlZmF1bHRQcm9wcyA9IHtcbiAgICB3aWR0aDogMjQwLFxuICAgIG9wZW5PbkZvY3VzOiBmYWxzZSxcbiAgICBkaXNhYmxlZDogZmFsc2UsXG4gICAgaXNMb2FkaW5nOiBmYWxzZVxuICB9XG5cbiAgY29uc3RydWN0b3IocHJvcHMsIGNvbnRleHQpIHtcbiAgICBzdXBlcihwcm9wcywgY29udGV4dClcbiAgICB0aGlzLnN0YXRlID0ge1xuICAgICAgaXNPcGVuZWRCeUJ1dHRvbjogZmFsc2VcbiAgICB9XG4gIH1cblxuICBoYW5kbGVTdGF0ZUNoYW5nZSA9IGNoYW5nZXMgPT4ge1xuICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoY2hhbmdlcywgJ2lzT3BlbicpKSB7XG4gICAgICBpZiAoIWNoYW5nZXMuaXNPcGVuKSB7XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoeyBpc09wZW5lZEJ5QnV0dG9uOiBmYWxzZSB9KVxuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHJlbmRlcigpIHtcbiAgICBjb25zdCB7XG4gICAgICBpdGVtcyxcbiAgICAgIHNlbGVjdGVkSXRlbSxcbiAgICAgIGRlZmF1bHRTZWxlY3RlZEl0ZW0sXG4gICAgICBpdGVtVG9TdHJpbmcsXG4gICAgICB3aWR0aCxcbiAgICAgIGhlaWdodCxcbiAgICAgIG9uQ2hhbmdlLFxuICAgICAgcGxhY2Vob2xkZXIsXG4gICAgICBpbnB1dFByb3BzLFxuICAgICAgYnV0dG9uUHJvcHMsXG4gICAgICBvcGVuT25Gb2N1cyxcbiAgICAgIGF1dG9jb21wbGV0ZVByb3BzLFxuICAgICAgaXNMb2FkaW5nLFxuICAgICAgLi4ucHJvcHNcbiAgICB9ID0gdGhpcy5wcm9wc1xuXG4gICAgY29uc3QgZGlzYWJsZWQgPSBwcm9wcy5kaXNhYmxlZCB8fCBpc0xvYWRpbmdcblxuICAgIHJldHVybiAoXG4gICAgICA8QXV0b2NvbXBsZXRlXG4gICAgICAgIGl0ZW1zPXtpdGVtc31cbiAgICAgICAgc2VsZWN0ZWRJdGVtPXtzZWxlY3RlZEl0ZW19XG4gICAgICAgIGRlZmF1bHRTZWxlY3RlZEl0ZW09e2RlZmF1bHRTZWxlY3RlZEl0ZW19XG4gICAgICAgIGl0ZW1Ub1N0cmluZz17aXRlbVRvU3RyaW5nfVxuICAgICAgICBvbkNoYW5nZT17b25DaGFuZ2V9XG4gICAgICAgIG9uU3RhdGVDaGFuZ2U9e3RoaXMuaGFuZGxlU3RhdGVDaGFuZ2V9XG4gICAgICAgIGlzRmlsdGVyRGlzYWJsZWQ9e3RoaXMuc3RhdGUuaXNPcGVuZWRCeUJ1dHRvbn1cbiAgICAgICAgey4uLmF1dG9jb21wbGV0ZVByb3BzfVxuICAgICAgPlxuICAgICAgICB7KHtcbiAgICAgICAgICBnZXRSZWYsXG4gICAgICAgICAgaXNTaG93bixcbiAgICAgICAgICBvcGVuTWVudSxcbiAgICAgICAgICBpbnB1dFZhbHVlLFxuICAgICAgICAgIGdldElucHV0UHJvcHMsXG4gICAgICAgICAgZ2V0QnV0dG9uUHJvcHMsXG4gICAgICAgICAgY2xlYXJTZWxlY3Rpb25cbiAgICAgICAgfSkgPT4gKFxuICAgICAgICAgIDxCb3hcbiAgICAgICAgICAgIGlubmVyUmVmPXtyZWYgPT4gZ2V0UmVmKHJlZil9XG4gICAgICAgICAgICBkaXNwbGF5PVwiaW5saW5lLWZsZXhcIlxuICAgICAgICAgICAgd2lkdGg9e3dpZHRofVxuICAgICAgICAgICAgey4uLnByb3BzfVxuICAgICAgICAgID5cbiAgICAgICAgICAgIDxUZXh0SW5wdXRcbiAgICAgICAgICAgICAgd2lkdGg9ezB9XG4gICAgICAgICAgICAgIGZsZXg9ezF9XG4gICAgICAgICAgICAgIGhlaWdodD17aGVpZ2h0fVxuICAgICAgICAgICAgICB2YWx1ZT17aW5wdXRWYWx1ZX1cbiAgICAgICAgICAgICAgYm9yZGVyVG9wUmlnaHRSYWRpdXM9ezB9XG4gICAgICAgICAgICAgIGJvcmRlckJvdHRvbVJpZ2h0UmFkaXVzPXswfVxuICAgICAgICAgICAgICBkaXNhYmxlZD17ZGlzYWJsZWR9XG4gICAgICAgICAgICAgIHsuLi5nZXRJbnB1dFByb3BzKHtcbiAgICAgICAgICAgICAgICAuLi5pbnB1dFByb3BzLFxuICAgICAgICAgICAgICAgIHBsYWNlaG9sZGVyLFxuICAgICAgICAgICAgICAgIG9uRm9jdXM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICAgIGlmIChvcGVuT25Gb2N1cykgb3Blbk1lbnUoKVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgb25DaGFuZ2U6IGUgPT4ge1xuICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuc3RhdGUuaXNPcGVuZWRCeUJ1dHRvbikge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgICAgICAgICAgICAgICBpc09wZW5lZEJ5QnV0dG9uOiBmYWxzZVxuICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICBpZiAoZS50YXJnZXQudmFsdWUudHJpbSgpID09PSAnJykge1xuICAgICAgICAgICAgICAgICAgICAvLyBQcmV2ZW50IHRoZSBzZWxlY3RlZCBpdGVtIGZyb20gc3RpY2tpbmcgYXJvdW5kXG4gICAgICAgICAgICAgICAgICAgIGNsZWFyU2VsZWN0aW9uKClcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH0pfVxuICAgICAgICAgICAgLz5cbiAgICAgICAgICAgIDxJY29uQnV0dG9uXG4gICAgICAgICAgICAgIGljb25BaW09XCJkb3duXCJcbiAgICAgICAgICAgICAgY29sb3I9XCJtdXRlZFwiXG4gICAgICAgICAgICAgIGljb249e2lzTG9hZGluZyA/ICcnIDogJ2NhcmV0LWRvd24nfVxuICAgICAgICAgICAgICBhcHBlYXJhbmNlPVwiZGVmYXVsdFwiXG4gICAgICAgICAgICAgIGhlaWdodD17aGVpZ2h0fVxuICAgICAgICAgICAgICBtYXJnaW5MZWZ0PXstMX1cbiAgICAgICAgICAgICAgcGFkZGluZ0xlZnQ9e2lzTG9hZGluZyA/IDEyIDogMH1cbiAgICAgICAgICAgICAgcGFkZGluZ1JpZ2h0PXswfVxuICAgICAgICAgICAgICBib3JkZXJUb3BMZWZ0UmFkaXVzPXswfVxuICAgICAgICAgICAgICBib3JkZXJCb3R0b21MZWZ0UmFkaXVzPXswfVxuICAgICAgICAgICAgICBkaXNhYmxlZD17ZGlzYWJsZWR9XG4gICAgICAgICAgICAgIGlzTG9hZGluZz17aXNMb2FkaW5nfVxuICAgICAgICAgICAgICB7Li4uZ2V0QnV0dG9uUHJvcHMoe1xuICAgICAgICAgICAgICAgIC4uLmJ1dHRvblByb3BzLFxuICAgICAgICAgICAgICAgIG9uQ2xpY2s6ICgpID0+IHtcbiAgICAgICAgICAgICAgICAgIGlmICghaXNTaG93bikge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNldFN0YXRlKHsgaXNPcGVuZWRCeUJ1dHRvbjogdHJ1ZSB9KVxuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfSl9XG4gICAgICAgICAgICAvPlxuICAgICAgICAgIDwvQm94PlxuICAgICAgICApfVxuICAgICAgPC9BdXRvY29tcGxldGU+XG4gICAgKVxuICB9XG59XG4iXX0=