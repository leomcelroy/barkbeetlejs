import _extends from "@babel/runtime/helpers/esm/extends";
import _objectWithoutProperties from "@babel/runtime/helpers/esm/objectWithoutProperties";
import _objectSpread from "@babel/runtime/helpers/esm/objectSpread";
import _toConsumableArray from "@babel/runtime/helpers/esm/toConsumableArray";
import _classCallCheck from "@babel/runtime/helpers/esm/classCallCheck";
import _createClass from "@babel/runtime/helpers/esm/createClass";
import _possibleConstructorReturn from "@babel/runtime/helpers/esm/possibleConstructorReturn";
import _getPrototypeOf from "@babel/runtime/helpers/esm/getPrototypeOf";
import _assertThisInitialized from "@babel/runtime/helpers/esm/assertThisInitialized";
import _inherits from "@babel/runtime/helpers/esm/inherits";
import _defineProperty from "@babel/runtime/helpers/esm/defineProperty";
import React from 'react';
import { css } from 'glamor';
import PropTypes from 'prop-types';
import { StackingOrder } from '../../constants';
import Toast from './Toast';
var wrapperClass = css({
  maxWidth: 560,
  margin: '0 auto',
  top: 0,
  left: 0,
  right: 0,
  position: 'fixed',
  zIndex: StackingOrder.TOASTER,
  pointerEvents: 'none'
});

var hasCustomId = function hasCustomId(settings) {
  return Object.hasOwnProperty.call(settings, 'id');
};

var ToastManager =
/*#__PURE__*/
function (_React$PureComponent) {
  _inherits(ToastManager, _React$PureComponent);

  function ToastManager(props, context) {
    var _this;

    _classCallCheck(this, ToastManager);

    _this = _possibleConstructorReturn(this, _getPrototypeOf(ToastManager).call(this, props, context));

    _defineProperty(_assertThisInitialized(_this), "getToasts", function () {
      return _this.state.toasts;
    });

    _defineProperty(_assertThisInitialized(_this), "closeAll", function () {
      _this.getToasts().forEach(function (toast) {
        return toast.close();
      });
    });

    _defineProperty(_assertThisInitialized(_this), "notify", function (title, settings) {
      // If there's a custom toast ID passed, close existing toasts with the same custom ID
      if (hasCustomId(settings)) {
        var _iteratorNormalCompletion = true;
        var _didIteratorError = false;
        var _iteratorError = undefined;

        try {
          for (var _iterator = _this.state.toasts[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
            var toast = _step.value;

            // Since unique ID is still appended to a custom ID, skip the unique ID and check only prefix
            if (String(toast.id).startsWith(settings.id)) {
              _this.closeToast(toast.id);
            }
          }
        } catch (err) {
          _didIteratorError = true;
          _iteratorError = err;
        } finally {
          try {
            if (!_iteratorNormalCompletion && _iterator.return != null) {
              _iterator.return();
            }
          } finally {
            if (_didIteratorError) {
              throw _iteratorError;
            }
          }
        }
      }

      var instance = _this.createToastInstance(title, settings);

      _this.setState(function (previousState) {
        return {
          toasts: [instance].concat(_toConsumableArray(previousState.toasts))
        };
      });

      return instance;
    });

    _defineProperty(_assertThisInitialized(_this), "createToastInstance", function (title, settings) {
      var uniqueId = ++ToastManager.idCounter;
      var id = hasCustomId(settings) ? "".concat(settings.id, "-").concat(uniqueId) : uniqueId;
      return {
        id: id,
        title: title,
        description: settings.description,
        hasCloseButton: settings.hasCloseButton || true,
        duration: settings.duration || 5,
        close: function close() {
          return _this.closeToast(id);
        },
        intent: settings.intent
      };
    });

    _defineProperty(_assertThisInitialized(_this), "closeToast", function (id) {
      _this.setState(function (previousState) {
        return {
          toasts: previousState.toasts.map(function (toast) {
            if (toast.id === id) {
              return _objectSpread({}, toast, {
                isShown: false
              });
            }

            return toast;
          })
        };
      });
    });

    _defineProperty(_assertThisInitialized(_this), "removeToast", function (id) {
      _this.setState(function (previousState) {
        return {
          toasts: previousState.toasts.filter(function (toast) {
            return toast.id !== id;
          })
        };
      });
    });

    props.bindNotify(_this.notify);
    props.bindGetToasts(_this.getToasts);
    props.bindCloseAll(_this.closeAll);
    _this.state = {
      toasts: []
    };
    return _this;
  }

  _createClass(ToastManager, [{
    key: "render",
    value: function render() {
      var _this2 = this;

      return React.createElement("span", {
        className: wrapperClass
      }, this.state.toasts.map(function (_ref) {
        var id = _ref.id,
            description = _ref.description,
            props = _objectWithoutProperties(_ref, ["id", "description"]);

        return React.createElement(Toast, _extends({
          key: id,
          onRemove: function onRemove() {
            return _this2.removeToast(id);
          }
        }, props), description);
      }));
    }
  }]);

  return ToastManager;
}(React.PureComponent);

ToastManager.displayName = "ToastManager";

_defineProperty(ToastManager, "propTypes", {
  /**
   * Function called with the `this.notify` function.
   */
  bindNotify: PropTypes.func.isRequired,

  /**
   * Function called with the `this.getToasts` function.
   */
  bindGetToasts: PropTypes.func.isRequired,

  /**
   * Function called with the `this.closeAll` function.
   */
  bindCloseAll: PropTypes.func.isRequired
});

_defineProperty(ToastManager, "idCounter", 0);

export { ToastManager as default };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy90b2FzdGVyL3NyYy9Ub2FzdE1hbmFnZXIuanMiXSwibmFtZXMiOlsiUmVhY3QiLCJjc3MiLCJQcm9wVHlwZXMiLCJTdGFja2luZ09yZGVyIiwiVG9hc3QiLCJ3cmFwcGVyQ2xhc3MiLCJtYXhXaWR0aCIsIm1hcmdpbiIsInRvcCIsImxlZnQiLCJyaWdodCIsInBvc2l0aW9uIiwiekluZGV4IiwiVE9BU1RFUiIsInBvaW50ZXJFdmVudHMiLCJoYXNDdXN0b21JZCIsInNldHRpbmdzIiwiT2JqZWN0IiwiaGFzT3duUHJvcGVydHkiLCJjYWxsIiwiVG9hc3RNYW5hZ2VyIiwicHJvcHMiLCJjb250ZXh0Iiwic3RhdGUiLCJ0b2FzdHMiLCJnZXRUb2FzdHMiLCJmb3JFYWNoIiwidG9hc3QiLCJjbG9zZSIsInRpdGxlIiwiU3RyaW5nIiwiaWQiLCJzdGFydHNXaXRoIiwiY2xvc2VUb2FzdCIsImluc3RhbmNlIiwiY3JlYXRlVG9hc3RJbnN0YW5jZSIsInNldFN0YXRlIiwicHJldmlvdXNTdGF0ZSIsInVuaXF1ZUlkIiwiaWRDb3VudGVyIiwiZGVzY3JpcHRpb24iLCJoYXNDbG9zZUJ1dHRvbiIsImR1cmF0aW9uIiwiaW50ZW50IiwibWFwIiwiaXNTaG93biIsImZpbHRlciIsImJpbmROb3RpZnkiLCJub3RpZnkiLCJiaW5kR2V0VG9hc3RzIiwiYmluZENsb3NlQWxsIiwiY2xvc2VBbGwiLCJyZW1vdmVUb2FzdCIsIlB1cmVDb21wb25lbnQiLCJmdW5jIiwiaXNSZXF1aXJlZCJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFBQSxPQUFPQSxLQUFQLE1BQWtCLE9BQWxCO0FBQ0EsU0FBU0MsR0FBVCxRQUFvQixRQUFwQjtBQUNBLE9BQU9DLFNBQVAsTUFBc0IsWUFBdEI7QUFDQSxTQUFTQyxhQUFULFFBQThCLGlCQUE5QjtBQUNBLE9BQU9DLEtBQVAsTUFBa0IsU0FBbEI7QUFFQSxJQUFNQyxZQUFZLEdBQUdKLEdBQUcsQ0FBQztBQUN2Qkss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NEIsUUFBNUJBLFdBQTRCO0FBQUEsWUFBWm5CLEtBQVk7O0FBQ3hELGVBQ0Usb0JBQUMsS0FBRDtBQUFPLFVBQUEsR0FBRyxFQUFFVSxFQUFaO0FBQWdCLFVBQUEsUUFBUSxFQUFFO0FBQUEsbUJBQU0sTUFBSSxDQUFDcUIsV0FBTCxDQUFpQnJCLEVBQWpCLENBQU47QUFBQTtBQUExQixXQUEwRFYsS0FBMUQsR0FDR21CLFdBREgsQ0FERjtBQUtELE9BTkEsQ0FESCxDQURGO0FBV0Q7Ozs7RUF0SHVDeEMsS0FBSyxDQUFDcUQsYTs7QUFBM0JqQyxZOztnQkFBQUEsWSxlQUNBO0FBQ2pCOzs7QUFHQTJCLEVBQUFBLFVBQVUsRUFBRTdDLFNBQVMsQ0FBQ29ELElBQVYsQ0FBZUMsVUFKVjs7QUFNakI7OztBQUdBTixFQUFBQSxhQUFhLEVBQUUvQyxTQUFTLENBQUNvRCxJQUFWLENBQWVDLFVBVGI7O0FBV2pCOzs7QUFHQUwsRUFBQUEsWUFBWSxFQUFFaEQsU0FBUyxDQUFDb0QsSUFBVixDQUFlQztBQWRaLEM7O2dCQURBbkMsWSxlQWtCQSxDOztTQWxCQUEsWSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBSZWFjdCBmcm9tICdyZWFjdCdcbmltcG9ydCB7IGNzcyB9IGZyb20gJ2dsYW1vcidcbmltcG9ydCBQcm9wVHlwZXMgZnJvbSAncHJvcC10eXBlcydcbmltcG9ydCB7IFN0YWNraW5nT3JkZXIgfSBmcm9tICcuLi8uLi9jb25zdGFudHMnXG5pbXBvcnQgVG9hc3QgZnJvbSAnLi9Ub2FzdCdcblxuY29uc3Qgd3JhcHBlckNsYXNzID0gY3NzKHtcbiAgbWF4V2lkdGg6IDU2MCxcbiAgbWFyZ2luOiAnMCBhdXRvJyxcbiAgdG9wOiAwLFxuICBsZWZ0OiAwLFxuICByaWdodDogMCxcbiAgcG9zaXRpb246ICdmaXhlZCcsXG4gIHpJbmRleDogU3RhY2tpbmdPcmRlci5UT0FTVEVSLFxuICBwb2ludGVyRXZlbnRzOiAnbm9uZSdcbn0pXG5cbmNvbnN0IGhhc0N1c3RvbUlkID0gc2V0dGluZ3MgPT4gT2JqZWN0Lmhhc093blByb3BlcnR5LmNhbGwoc2V0dGluZ3MsICdpZCcpXG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFRvYXN0TWFuYWdlciBleHRlbmRzIFJlYWN0LlB1cmVDb21wb25lbnQge1xuICBzdGF0aWMgcHJvcFR5cGVzID0ge1xuICAgIC8qKlxuICAgICAqIEZ1bmN0aW9uIGNhbGxlZCB3aXRoIHRoZSBgdGhpcy5ub3RpZnlgIGZ1bmN0aW9uLlxuICAgICAqL1xuICAgIGJpbmROb3RpZnk6IFByb3BUeXBlcy5mdW5jLmlzUmVxdWlyZWQsXG5cbiAgICAvKipcbiAgICAgKiBGdW5jdGlvbiBjYWxsZWQgd2l0aCB0aGUgYHRoaXMuZ2V0VG9hc3RzYCBmdW5jdGlvbi5cbiAgICAgKi9cbiAgICBiaW5kR2V0VG9hc3RzOiBQcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkLFxuXG4gICAgLyoqXG4gICAgICogRnVuY3Rpb24gY2FsbGVkIHdpdGggdGhlIGB0aGlzLmNsb3NlQWxsYCBmdW5jdGlvbi5cbiAgICAgKi9cbiAgICBiaW5kQ2xvc2VBbGw6IFByb3BUeXBlcy5mdW5jLmlzUmVxdWlyZWRcbiAgfVxuXG4gIHN0YXRpYyBpZENvdW50ZXIgPSAwXG5cbiAgY29uc3RydWN0b3IocHJvcHMsIGNvbnRleHQpIHtcbiAgICBzdXBlcihwcm9wcywgY29udGV4dClcblxuICAgIHByb3BzLmJpbmROb3RpZnkodGhpcy5ub3RpZnkpXG4gICAgcHJvcHMuYmluZEdldFRvYXN0cyh0aGlzLmdldFRvYXN0cylcbiAgICBwcm9wcy5iaW5kQ2xvc2VBbGwodGhpcy5jbG9zZUFsbClcblxuICAgIHRoaXMuc3RhdGUgPSB7XG4gICAgICB0b2FzdHM6IFtdXG4gICAgfVxuICB9XG5cbiAgZ2V0VG9hc3RzID0gKCkgPT4ge1xuICAgIHJldHVybiB0aGlzLnN0YXRlLnRvYXN0c1xuICB9XG5cbiAgY2xvc2VBbGwgPSAoKSA9PiB7XG4gICAgdGhpcy5nZXRUb2FzdHMoKS5mb3JFYWNoKHRvYXN0ID0+IHRvYXN0LmNsb3NlKCkpXG4gIH1cblxuICBub3RpZnkgPSAodGl0bGUsIHNldHRpbmdzKSA9PiB7XG4gICAgLy8gSWYgdGhlcmUncyBhIGN1c3RvbSB0b2FzdCBJRCBwYXNzZWQsIGNsb3NlIGV4aXN0aW5nIHRvYXN0cyB3aXRoIHRoZSBzYW1lIGN1c3RvbSBJRFxuICAgIGlmIChoYXNDdXN0b21JZChzZXR0aW5ncykpIHtcbiAgICAgIGZvciAoY29uc3QgdG9hc3Qgb2YgdGhpcy5zdGF0ZS50b2FzdHMpIHtcbiAgICAgICAgLy8gU2luY2UgdW5pcXVlIElEIGlzIHN0aWxsIGFwcGVuZGVkIHRvIGEgY3VzdG9tIElELCBza2lwIHRoZSB1bmlxdWUgSUQgYW5kIGNoZWNrIG9ubHkgcHJlZml4XG4gICAgICAgIGlmIChTdHJpbmcodG9hc3QuaWQpLnN0YXJ0c1dpdGgoc2V0dGluZ3MuaWQpKSB7XG4gICAgICAgICAgdGhpcy5jbG9zZVRvYXN0KHRvYXN0LmlkKVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgY29uc3QgaW5zdGFuY2UgPSB0aGlzLmNyZWF0ZVRvYXN0SW5zdGFuY2UodGl0bGUsIHNldHRpbmdzKVxuXG4gICAgdGhpcy5zZXRTdGF0ZShwcmV2aW91c1N0YXRlID0+IHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHRvYXN0czogW2luc3RhbmNlLCAuLi5wcmV2aW91c1N0YXRlLnRvYXN0c11cbiAgICAgIH1cbiAgICB9KVxuXG4gICAgcmV0dXJuIGluc3RhbmNlXG4gIH1cblxuICBjcmVhdGVUb2FzdEluc3RhbmNlID0gKHRpdGxlLCBzZXR0aW5ncykgPT4ge1xuICAgIGNvbnN0IHVuaXF1ZUlkID0gKytUb2FzdE1hbmFnZXIuaWRDb3VudGVyXG4gICAgY29uc3QgaWQgPSBoYXNDdXN0b21JZChzZXR0aW5ncykgPyBgJHtzZXR0aW5ncy5pZH0tJHt1bmlxdWVJZH1gIDogdW5pcXVlSWRcblxuICAgIHJldHVybiB7XG4gICAgICBpZCxcbiAgICAgIHRpdGxlLFxuICAgICAgZGVzY3JpcHRpb246IHNldHRpbmdzLmRlc2NyaXB0aW9uLFxuICAgICAgaGFzQ2xvc2VCdXR0b246IHNldHRpbmdzLmhhc0Nsb3NlQnV0dG9uIHx8IHRydWUsXG4gICAgICBkdXJhdGlvbjogc2V0dGluZ3MuZHVyYXRpb24gfHwgNSxcbiAgICAgIGNsb3NlOiAoKSA9PiB0aGlzLmNsb3NlVG9hc3QoaWQpLFxuICAgICAgaW50ZW50OiBzZXR0aW5ncy5pbnRlbnRcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogVGhpcyB3aWxsIHNldCBpc1Nob3duIG9uIHRoZSBUb2FzdCB3aGljaCB3aWxsIGNsb3NlIHRoZSB0b2FzdC5cbiAgICogSXQgd29uJ3QgcmVtb3ZlIHRoZSB0b2FzdCB1bnRpbCBvbkV4aXRlZCB0cmlnZ2VycyBvblJlbW92ZS5cbiAgICovXG4gIGNsb3NlVG9hc3QgPSBpZCA9PiB7XG4gICAgdGhpcy5zZXRTdGF0ZShwcmV2aW91c1N0YXRlID0+IHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHRvYXN0czogcHJldmlvdXNTdGF0ZS50b2FzdHMubWFwKHRvYXN0ID0+IHtcbiAgICAgICAgICBpZiAodG9hc3QuaWQgPT09IGlkKSB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAuLi50b2FzdCxcbiAgICAgICAgICAgICAgaXNTaG93bjogZmFsc2VcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG5cbiAgICAgICAgICByZXR1cm4gdG9hc3RcbiAgICAgICAgfSlcbiAgICAgIH1cbiAgICB9KVxuICB9XG5cbiAgcmVtb3ZlVG9hc3QgPSBpZCA9PiB7XG4gICAgdGhpcy5zZXRTdGF0ZShwcmV2aW91c1N0YXRlID0+IHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHRvYXN0czogcHJldmlvdXNTdGF0ZS50b2FzdHMuZmlsdGVyKHRvYXN0ID0+IHRvYXN0LmlkICE9PSBpZClcbiAgICAgIH1cbiAgICB9KVxuICB9XG5cbiAgcmVuZGVyKCkge1xuICAgIHJldHVybiAoXG4gICAgICA8c3BhbiBjbGFzc05hbWU9e3dyYXBwZXJDbGFzc30+XG4gICAgICAgIHt0aGlzLnN0YXRlLnRvYXN0cy5tYXAoKHsgaWQsIGRlc2NyaXB0aW9uLCAuLi5wcm9wcyB9KSA9PiB7XG4gICAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAgIDxUb2FzdCBrZXk9e2lkfSBvblJlbW92ZT17KCkgPT4gdGhpcy5yZW1vdmVUb2FzdChpZCl9IHsuLi5wcm9wc30+XG4gICAgICAgICAgICAgIHtkZXNjcmlwdGlvbn1cbiAgICAgICAgICAgIDwvVG9hc3Q+XG4gICAgICAgICAgKVxuICAgICAgICB9KX1cbiAgICAgIDwvc3Bhbj5cbiAgICApXG4gIH1cbn1cbiJdfQ==